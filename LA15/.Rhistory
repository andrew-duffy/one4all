cor_lit_le<-cor(lit,lifeExp)
cor_HIV_le<-cor(HIV,lifeExp)
pc_lit_le<-tibble(cor=perm_cor(perms=1000,lit,lifeExp))
pc_HIV_le<-tibble(cor=perm_cor(perms=1000,HIV,lifeExp))
plow_lit_le<-quantile(pc_lit_le,probs=.025)[[1]]
lit<-tdata$Literacy
HIV<-tdata$HIV
lifeExp<-tdata$Life_exp
cor_lit_le<-cor(lit,lifeExp)
cor_HIV_le<-cor(HIV,lifeExp)
pc_lit_le<-tibble(cor=perm_cor(perms=1000,lit,lifeExp))
pc_HIV_le<-tibble(cor=perm_cor(perms=1000,HIV,lifeExp))
plow_lit_le<-quantile(pc_lit_le,probs=.025)[1]
lit<-tdata$Literacy
HIV<-tdata$HIV
lifeExp<-tdata$Life_exp
cor_lit_le<-cor(lit,lifeExp)
cor_HIV_le<-cor(HIV,lifeExp)
pc_lit_le<-tibble(cor=perm_cor(perms=1000,lit,lifeExp))
pc_HIV_le<-tibble(cor=perm_cor(perms=1000,HIV,lifeExp))
(plow_lit_le<-quantile(pc_lit_le,probs=.025))
lit<-tdata$Literacy
HIV<-tdata$HIV
lifeExp<-tdata$Life_exp
cor_lit_le<-cor(lit,lifeExp)
cor_HIV_le<-cor(HIV,lifeExp)
pc_lit_le<-tibble(cor=perm_cor(perms=1000,lit,lifeExp))
pc_HIV_le<-tibble(cor=perm_cor(perms=1000,HIV,lifeExp))
plow_lit_le<-quantile(pc_lit_le$cor,probs=.025)[[1]]
phigh_lit_le<-quantile(pc_lit_le$cor,probs=.975)[[1]]
plow_HIV_le<-quantile(pc_HIV_le$cor,probs=.025)[[1]]
phigh_HIV_le<-quantile(pc_HIV_le$cor,probs=.975)[[1]]
ggplot(pc_lit_le,aes(cor,fill=(cor<plow_lit_le|cor>plow_lit_le)))+geom_histogram()
ggplot(pc_HIV_le,aes(cor,fill=(cor<plow_HIV_le|cor>plow_HIV_le)))+geom_histogram()
lit<-tdata$Literacy
HIV<-tdata$HIV
lifeExp<-tdata$Life_exp
cor_lit_le<-cor(lit,lifeExp)
cor_HIV_le<-cor(HIV,lifeExp)
pc_lit_le<-tibble(cor=perm_cor(perms=1000,lit,lifeExp))
pc_HIV_le<-tibble(cor=perm_cor(perms=1000,HIV,lifeExp))
(plow_lit_le<-quantile(pc_lit_le$cor,probs=.025)[[1]])
(phigh_lit_le<-quantile(pc_lit_le$cor,probs=.975)[[1]])
plow_HIV_le<-quantile(pc_HIV_le$cor,probs=.025)[[1]]
phigh_HIV_le<-quantile(pc_HIV_le$cor,probs=.975)[[1]]
ggplot(pc_lit_le,aes(cor,fill=(cor<plow_lit_le|cor>plow_lit_le)))+geom_histogram()
ggplot(pc_HIV_le,aes(cor,fill=(cor<plow_HIV_le|cor>plow_HIV_le)))+geom_histogram()
lit<-tdata$Literacy
HIV<-tdata$HIV
lifeExp<-tdata$Life_exp
cor_lit_le<-cor(lit,lifeExp)
cor_HIV_le<-cor(HIV,lifeExp)
pc_lit_le<-tibble(cor=perm_cor(perms=1000,lit,lifeExp))
pc_HIV_le<-tibble(cor=perm_cor(perms=1000,HIV,lifeExp))
plow_lit_le<-quantile(pc_lit_le$cor,probs=.025)[[1]]
phigh_lit_le<-quantile(pc_lit_le$cor,probs=.975)[[1]]
plow_HIV_le<-quantile(pc_HIV_le$cor,probs=.025)[[1]]
phigh_HIV_le<-quantile(pc_HIV_le$cor,probs=.975)[[1]]
ggplot(pc_lit_le,aes(cor,fill=(cor<plow_lit_le|cor>phigh_lit_le)))+geom_histogram()
ggplot(pc_HIV_le,aes(cor,fill=(cor<plow_HIV_le|cor>phigh_HIV_le)))+geom_histogram()
lit<-tdata$Literacy
HIV<-tdata$HIV
lifeExp<-tdata$Life_exp
cor_lit_le<-cor(lit,lifeExp)
cor_HIV_le<-cor(HIV,lifeExp)
pc_lit_le<-tibble(cor=perm_cor(perms=1000,lit,lifeExp))
pc_HIV_le<-tibble(cor=perm_cor(perms=1000,HIV,lifeExp))
plow_lit_le<-quantile(pc_lit_le$cor,probs=.025)[[1]]
phigh_lit_le<-quantile(pc_lit_le$cor,probs=.975)[[1]]
plow_HIV_le<-quantile(pc_HIV_le$cor,probs=.025)[[1]]
phigh_HIV_le<-quantile(pc_HIV_le$cor,probs=.975)[[1]]
ggplot(pc_lit_le,aes(cor,fill=(cor<plow_lit_le|cor>phigh_lit_le)))+geom_histogram()+
labs(title="Literacy rate and Life Expectancy Permutation Correlation Test",
x="Correlation Between Literacy rate and Life Expectancy",
fill="Tails")
ggplot(pc_HIV_le,aes(cor,fill=(cor<plow_HIV_le|cor>phigh_HIV_le)))+geom_histogram()+
labs(title="Female HIV rate and Life Expectancy permutation Correlation Test",
x="Correlation between Female HIV rate and Life Expectancy",
fill="Tails")
lit<-tdata$Literacy
HIV<-tdata$HIV
lifeExp<-tdata$Life_exp
cor_lit_le<-cor(lit,lifeExp)
cor_HIV_le<-cor(HIV,lifeExp)
pc_lit_le<-tibble(cor=perm_cor(perms=1000,lit,lifeExp))
pc_HIV_le<-tibble(cor=perm_cor(perms=1000,HIV,lifeExp))
plow_lit_le<-quantile(pc_lit_le$cor,probs=.025)[[1]]
phigh_lit_le<-quantile(pc_lit_le$cor,probs=.975)[[1]]
plow_HIV_le<-quantile(pc_HIV_le$cor,probs=.025)[[1]]
phigh_HIV_le<-quantile(pc_HIV_le$cor,probs=.975)[[1]]
ggplot(pc_lit_le,aes(cor,fill=(cor<plow_lit_le|cor>phigh_lit_le)))+geom_histogram()+geom_vline(xintercept = cor_lit_le)+
labs(title="Literacy rate and Life Expectancy Permutation Correlation Test",
x="Correlation Between Literacy rate and Life Expectancy",
fill="Tails")
ggplot(pc_HIV_le,aes(cor,fill=(cor<plow_HIV_le|cor>phigh_HIV_le)))+geom_histogram()+geom_vline(xintercept = cor_HIV_le)+
labs(title="Female HIV rate and Life Expectancy permutation Correlation Test",
x="Correlation between Female HIV rate and Life Expectancy",
fill="Tails")
lit<-tdata$Literacy
HIV<-tdata$HIV
lifeExp<-tdata$Life_exp
cor_lit_le<-cor(lit,lifeExp,use = "pairwise.complete.obs")
cor_HIV_le<-cor(HIV,lifeExp,use="pairwise.complete.obs")
pc_lit_le<-tibble(cor=perm_cor(perms=1000,lit,lifeExp))
pc_HIV_le<-tibble(cor=perm_cor(perms=1000,HIV,lifeExp))
plow_lit_le<-quantile(pc_lit_le$cor,probs=.025)[[1]]
phigh_lit_le<-quantile(pc_lit_le$cor,probs=.975)[[1]]
plow_HIV_le<-quantile(pc_HIV_le$cor,probs=.025)[[1]]
phigh_HIV_le<-quantile(pc_HIV_le$cor,probs=.975)[[1]]
ggplot(pc_lit_le,aes(cor,fill=(cor<plow_lit_le|cor>phigh_lit_le)))+geom_histogram()+geom_vline(xintercept = cor_lit_le)+
labs(title="Literacy rate and Life Expectancy Permutation Correlation Test",
x="Correlation Between Literacy rate and Life Expectancy",
fill="Tails")
ggplot(pc_HIV_le,aes(cor,fill=(cor<plow_HIV_le|cor>phigh_HIV_le)))+geom_histogram()+geom_vline(xintercept = cor_HIV_le)+
labs(title="Female HIV rate and Life Expectancy permutation Correlation Test",
x="Correlation between Female HIV rate and Life Expectancy",
fill="Tails")
lit<-tdata$Literacy
HIV<-tdata$HIV
lifeExp<-tdata$Life_exp
cor_lit_le<-cor(lit,lifeExp,use = "pairwise.complete.obs")
cor_HIV_le<-cor(HIV,lifeExp,use="pairwise.complete.obs")
pc_lit_le<-tibble(cor=perm_cor(perms=1000,lit,lifeExp))
pc_HIV_le<-tibble(cor=perm_cor(perms=1000,HIV,lifeExp))
plow_lit_le<-quantile(pc_lit_le$cor,probs=.025)[[1]]
phigh_lit_le<-quantile(pc_lit_le$cor,probs=.975)[[1]]
plow_HIV_le<-quantile(pc_HIV_le$cor,probs=.025)[[1]]
phigh_HIV_le<-quantile(pc_HIV_le$cor,probs=.975)[[1]]
ggplot(pc_lit_le,aes(cor,fill=(cor<plow_lit_le|cor>phigh_lit_le)))+geom_histogram(binwidth = .01)+geom_vline(xintercept = cor_lit_le)+
labs(title="Literacy rate and Life Expectancy Permutation Correlation Test",
x="Correlation Between Literacy rate and Life Expectancy",
fill="Tails")
ggplot(pc_HIV_le,aes(cor,fill=(cor<plow_HIV_le|cor>phigh_HIV_le)))+geom_histogram(binwidth = .01)+geom_vline(xintercept = cor_HIV_le)+
labs(title="Female HIV rate and Life Expectancy permutation Correlation Test",
x="Correlation between Female HIV rate and Life Expectancy",
fill="Tails")
lit<-tdata$Literacy
HIV<-tdata$HIV
lifeExp<-tdata$Life_exp
cor_lit_le<-cor(lit,lifeExp,use = "pairwise.complete.obs")
cor_HIV_le<-cor(HIV,lifeExp,use="pairwise.complete.obs")
pc_lit_le<-tibble(cor=perm_cor(perms=1000,lit,lifeExp))
pc_HIV_le<-tibble(cor=perm_cor(perms=1000,HIV,lifeExp))
plow_lit_le<-quantile(pc_lit_le$cor,probs=.025)[[1]]
phigh_lit_le<-quantile(pc_lit_le$cor,probs=.975)[[1]]
plow_HIV_le<-quantile(pc_HIV_le$cor,probs=.025)[[1]]
phigh_HIV_le<-quantile(pc_HIV_le$cor,probs=.975)[[1]]
ggplot(pc_lit_le,aes(cor,fill=(cor<plow_lit_le|cor>phigh_lit_le)))+geom_histogram(binwidth = .01)+geom_vline(xintercept = cor_lit_le)+
labs(title="Literacy rate and Life Expectancy Permutation Correlation Test",
x="Correlation Between Literacy rate and Life Expectancy",
fill="Tails")
ggplot(pc_HIV_le,aes(cor,fill=(cor<plow_HIV_le|cor>phigh_HIV_le)))+geom_histogram(binwidth = .01)+geom_vline(xintercept = cor_HIV_le)+
labs(title="Female HIV rate and Life Expectancy permutation Correlation Test",
x="Correlation between Female HIV rate and Life Expectancy",
fill="Tails")
percentile_lit_le<-nrow(filter(pc_lit_le,cor<cor_lit_le))/nrow(pc_lit_le)
percentile_HIV_le<-nrow(filter(pc_HIV_le,cor<cor_HIV_le))/nrow(pc_HIV_le)
lit<-tdata$Literacy
HIV<-tdata$HIV
lifeExp<-tdata$Life_exp
cor_lit_le<-cor(lit,lifeExp,use = "pairwise.complete.obs")
cor_HIV_le<-cor(HIV,lifeExp,use="pairwise.complete.obs")
pc_lit_le<-tibble(cor=perm_cor(perms=1000,lit,lifeExp))
pc_HIV_le<-tibble(cor=perm_cor(perms=1000,HIV,lifeExp))
plow_lit_le<-quantile(pc_lit_le$cor,probs=.025)[[1]]
phigh_lit_le<-quantile(pc_lit_le$cor,probs=.975)[[1]]
plow_HIV_le<-quantile(pc_HIV_le$cor,probs=.025)[[1]]
phigh_HIV_le<-quantile(pc_HIV_le$cor,probs=.975)[[1]]
ggplot(pc_lit_le,aes(cor,fill=(cor<plow_lit_le|cor>phigh_lit_le)))+geom_histogram(binwidth = .01)+geom_vline(xintercept = cor_lit_le)+
labs(title="Literacy rate and Life Expectancy Permutation Correlation Test",
x="Correlation Between Literacy rate and Life Expectancy",
fill="Tails")
ggplot(pc_HIV_le,aes(cor,fill=(cor<plow_HIV_le|cor>phigh_HIV_le)))+geom_histogram(binwidth = .01)+geom_vline(xintercept = cor_HIV_le)+
labs(title="Female HIV rate and Life Expectancy permutation Correlation Test",
x="Correlation between Female HIV rate and Life Expectancy",
fill="Tails")
percentile_lit_le<-nrow(filter(pc_lit_le,cor<cor_lit_le))/nrow(pc_lit_le)
percentile_HIV_le<-nrow(filter(pc_HIV_le,cor<cor_HIV_le))/nrow(pc_HIV_le)
ptable<-tibble("Percentile of:"=c("Literacy Rate and Life Expectancy Permutation Correlation Test","Female HIV Rate and Life Expectancy Permutation Correlation Test"),"Value:"=
c(cor_lit_le,cor_HIV_le))
ptable
lit<-tdata$Literacy
HIV<-tdata$HIV
lifeExp<-tdata$Life_exp
cor_lit_le<-cor(lit,lifeExp,use = "pairwise.complete.obs")
cor_HIV_le<-cor(HIV,lifeExp,use="pairwise.complete.obs")
pc_lit_le<-tibble(cor=perm_cor(perms=1000,lit,lifeExp))
pc_HIV_le<-tibble(cor=perm_cor(perms=1000,HIV,lifeExp))
plow_lit_le<-quantile(pc_lit_le$cor,probs=.025)[[1]]
phigh_lit_le<-quantile(pc_lit_le$cor,probs=.975)[[1]]
plow_HIV_le<-quantile(pc_HIV_le$cor,probs=.025)[[1]]
phigh_HIV_le<-quantile(pc_HIV_le$cor,probs=.975)[[1]]
ggplot(pc_lit_le,aes(cor,fill=(cor<plow_lit_le|cor>phigh_lit_le)))+geom_histogram(binwidth = .01)+geom_vline(xintercept = cor_lit_le)+
labs(title="Literacy rate and Life Expectancy Permutation Correlation Test",
x="Correlation Between Literacy rate and Life Expectancy",
fill="Tails")
ggplot(pc_HIV_le,aes(cor,fill=(cor<plow_HIV_le|cor>phigh_HIV_le)))+geom_histogram(binwidth = .01)+geom_vline(xintercept = cor_HIV_le)+
labs(title="Female HIV rate and Life Expectancy permutation Correlation Test",
x="Correlation between Female HIV rate and Life Expectancy",
fill="Tails")
percentile_lit_le<-nrow(filter(pc_lit_le,cor<cor_lit_le))/nrow(pc_lit_le)
percentile_HIV_le<-nrow(filter(pc_HIV_le,cor<cor_HIV_le))/nrow(pc_HIV_le)
ptable<-tibble("Percentile of:"=c("Literacy Rate and Life Expectancy Permutation Correlation Test","Female HIV Rate and Life Expectancy Permutation Correlation Test"),"Value:"=
c(percentile_lit_le,percentile_HIV_le))
ptable
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(purrr)
library(modelr)
perm_mean <- function(perms = 1000, all_values, n_A)
{
## Variables ##
# perms: The number of permutations
# all_values (num): all data values
# n_A (int): Size of group A
###############
# Step 1:
# Create vector of zeroes of length "perms" to store
# permuted mean differnces
permuted_mean_differences<-rep(0,perms)
# Loop throught number of permutations
for (i in c(1:perms))
{
# Step 2:
# Randomly separate vector "values" into disjoint
# groups of size "nA" and "nB" respectively
temp<-sample(all_values)
group_A<-temp[1:n_A]
group_B<-temp[(n_A+1):length(temp)]
# Step 3:
# Compute the sample means for the two groups from
# step 2
mean_A<-mean(group_A,na.rm=T)
mean_B<-mean(group_B,na.rm=T)
# Step 4:
# Compute the difference in sample means, store the
# value in the vector from step 1
permuted_mean_differences[i]<-mean_A-mean_B
}
# Step 5:
# Return the permuted mean differences vector
return(permuted_mean_differences)
}
perm_cor <- function(perms = 1000, x, y)
{
## Variables ##
# perms: The number of permutations
# x: Vector of Variable 1 - for computing correlation
# y: Vector of Variable 2 - for computing correlation
###############
# Step 1:
# Create vector of zeroes of length "perms" to store
# permuted mean differnces
correlations<-rep(0,perms)
# Loop throught number of permutations
for (i in c(1:perms))
{
# Step 2:
# Randomly mix up the values in the vector "y"
temp<-sample(y)
# Step 3:
# Compute the correlation between x and the randomly mixed
# up y-vector. Store this value in the vector from step 1.
correlations[i]<-cor(x,temp,use="pairwise.complete.obs")
}
# Step 4:
# Return new updated vector, created in step 1
return(correlations)
}
df <- read_csv(file = "data1.csv", col_types=cols(CreationDate=col_datetime()))
info <- read_csv(file = "data2.csv")
colnames(df) <- c("Country", "Abbreviation", "Measuring", "Code", "1995", "1996", "1997", "1998", "1999", "2001", "2002", "2003", "2004", "2005", "2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019")
worlddata <- df %>% group_by(Country) %>% nest()
df<-df[,-29]
df<-df%>%gather(`1995`:`2019`,key=year,value=measurement)%>%select(Country,Measuring,year,measurement)%>%filter(Country!="Data from database: World Development Indicators")%>%
filter(Country!="Last Updated: 10/28/2019")%>%filter(!is.na(Country))
countries<-unique(df$Country)
#countries
afghanistan<-df%>%filter(Country=="Afghanistan")%>%spread(key=Measuring,value=measurement)
cleaned<-afghanistan
countries<-countries[-1]
for(i in 1:length(countries)){
temp<-df%>%filter(Country==countries[i])%>%spread(key=Measuring,value=measurement)
cleaned<-rbind(cleaned,temp)
}
cleaned
tdata<-cleaned%>%select(Country,year,GDPpc=`GDP per capita (current US$)`,Literacy= `Literacy rate, adult total (% of people ages 15 and above)`,Life_exp=`Life expectancy at birth, total (years)`,
HIV=`Women's share of population ages 15+ living with HIV (%)`)
tdata<-tdata%>%mutate(year=as.double(year),GDPpc=as.double(GDPpc),Literacy=as.double(Literacy),Life_exp=as.double(Life_exp),HIV=as.double(HIV))
tdata
visualdata <- tdata %>% group_by(year)
visualdata <- visualdata[, -1]
ggplot(data = visualdata) + geom_smooth(mapping = aes(x = year, y = HIV), se = FALSE) + ggtitle("Worldwide rate of Women with HIV") + labs(x = "Year", y = "Female HIV rate")
ggplot(data = visualdata) + geom_smooth(mapping = aes(x = year, y = Life_exp), se = FALSE) + ggtitle("Worldwide rate of Life Expectancy") + labs(x = "Year", y = "Life Expectancy")
ggplot(data = visualdata) + geom_smooth(mapping = aes(x = year, y = GDPpc), se = FALSE) + ggtitle("Worldwide average of GDP per capita") + labs(x = "Year", y = "GDP per capita (US$)")
ggplot(data = visualdata) + geom_smooth(mapping = aes(x = year, y = Literacy), se = FALSE) + ggtitle("Worldwide Literacy rate") + labs(x = "Year", y = "Literacy rate")
sadata <- tdata %>% filter(Country == "South Africa") %>% group_by(year)
ggplot(data = sadata) + geom_smooth(mapping = aes(x = year, y = HIV), se = FALSE) + ggtitle("South Africa rate of Women with HIV") + labs(x = "Year", y = "Female HIV rate")
ggplot(data = sadata) + geom_smooth(mapping = aes(x = year, y = Life_exp), se = FALSE) + ggtitle("South Africa Life Expectancy") + labs(x = "Year", y = "Life Expectancy")
ggplot(data = sadata) + geom_smooth(mapping = aes(x = year, y = GDPpc), se = FALSE) + ggtitle("South Africa GDP per capita") + labs(x = "Year", y = "GDP per capita")
ggplot(data = sadata) + geom_smooth(mapping = aes(x = year, y = Literacy), se = FALSE) + ggtitle("South Africa Literacy rate") + labs(x = "Year", y = "Literacy rate")
ukdata <- tdata %>% filter(Country == "United Kingdom") %>% group_by(year)
ggplot(data = visualdata) + geom_smooth(mapping = aes(x = year, y = HIV), se = FALSE) + ggtitle("Worldwide rate of Women with HIV") + labs(x = "Year", y = "Female HIV rate")
ggplot(data = visualdata) + geom_smooth(mapping = aes(x = year, y = Life_exp), se = FALSE) + ggtitle("Worldwide rate of Life Expectancy") + labs(x = "Year", y = "Life Expectancy")
ggplot(data = visualdata) + geom_smooth(mapping = aes(x = year, y = GDPpc), se = FALSE) + ggtitle("Worldwide average of GDP per capita") + labs(x = "Year", y = "GDP per capita")
ggplot(data = visualdata) + geom_smooth(mapping = aes(x = year, y = Literacy), se = FALSE) + ggtitle("Worldwide Literacy rate") + labs(x = "Year", y = "Literacy rate")
lit<-tdata$Literacy
HIV<-tdata$HIV
lifeExp<-tdata$Life_exp
cor_lit_le<-cor(lit,lifeExp,use = "pairwise.complete.obs")
cor_HIV_le<-cor(HIV,lifeExp,use="pairwise.complete.obs")
pc_lit_le<-tibble(cor=perm_cor(perms=1000,lit,lifeExp))
pc_HIV_le<-tibble(cor=perm_cor(perms=1000,HIV,lifeExp))
plow_lit_le<-quantile(pc_lit_le$cor,probs=.025)[[1]]
phigh_lit_le<-quantile(pc_lit_le$cor,probs=.975)[[1]]
plow_HIV_le<-quantile(pc_HIV_le$cor,probs=.025)[[1]]
phigh_HIV_le<-quantile(pc_HIV_le$cor,probs=.975)[[1]]
ggplot(pc_lit_le,aes(cor,fill=(cor<plow_lit_le|cor>phigh_lit_le)))+geom_histogram(binwidth = .01)+geom_vline(xintercept = cor_lit_le)+
labs(title="Literacy rate and Life Expectancy Permutation Correlation Test",
x="Correlation Between Literacy rate and Life Expectancy",
fill="Tails")
ggplot(pc_HIV_le,aes(cor,fill=(cor<plow_HIV_le|cor>phigh_HIV_le)))+geom_histogram(binwidth = .01)+geom_vline(xintercept = cor_HIV_le)+
labs(title="Female HIV rate and Life Expectancy permutation Correlation Test",
x="Correlation between Female HIV rate and Life Expectancy",
fill="Tails")
percentile_lit_le<-nrow(filter(pc_lit_le,cor<cor_lit_le))/nrow(pc_lit_le)
percentile_HIV_le<-nrow(filter(pc_HIV_le,cor<cor_HIV_le))/nrow(pc_HIV_le)
ptable<-tibble("Percentile of:"=c("Literacy Rate and Life Expectancy Permutation Correlation Test","Female HIV Rate and Life Expectancy Permutation Correlation Test"),"Value:"=
c(percentile_lit_le,percentile_HIV_le))
ptable
urbanHIV <- cleaned %>% select(Country,year, HIV=`Women's share of population ages 15+ living with HIV (%)`, Urban = `Urban population growth (annual %)`)
urbanHIV <- urbanHIV %>% mutate(year=as.double(year), HIV=as.double(HIV), Urban = as.double(Urban))
ggplot(data = urbanHIV) + geom_smooth(mapping = aes(x = year, y = Urban), se = FALSE) + ggtitle("Worldwide Urban Population growth") + labs(x = "Year", y = "Urban Population Growth, %")
#we have already seen the worldwide hiv rate graph, but here it is again for good measure
ggplot(data = urbanHIV) + geom_smooth(mapping = aes(x = year, y = HIV), se = FALSE) + ggtitle("Worldwide rate of Women with HIV") + labs(x = "Year", y = "Female HIV rate")
mongolia <- urbanHIV %>% filter(Country == "Mongolia")
ggplot(data = mongolia) + geom_smooth(mapping = aes(x = year, y = Urban), se = FALSE) + ggtitle("Mongolia's Urban Population growth") + labs(x = "Year", y = "Urban Population Growth, %")
ggplot(data = mongolia) + geom_smooth(mapping = aes(x = year, y = HIV), se = FALSE) + ggtitle("Mongolia's rate of Women with HIV") + labs(x = "Year", y = "Female HIV rate")
Fr <- urbanHIV %>% filter(Country == "France")
ggplot(data = Fr) + geom_smooth(mapping = aes(x = year, y = Urban), se = FALSE) + ggtitle("France Urban Population growth") + labs(x = "Year", y = "Urban Population Growth, %")
ggplot(data = Fr) + geom_smooth(mapping = aes(x = year, y = HIV), se = FALSE) + ggtitle("France's rate of Women with HIV") + labs(x = "Year", y = "Female HIV rate")
AFsample <- urbanHIV %>% filter(year <= "2006") %>% filter(Country == "South Africa" | Country == "Mongolia" | Country == "Central African Republic" | Country == "Ethiopia")
AFRresults <- perm_cor(perms = 1000, AFsample$Urban, AFsample$HIV)
FRresults <- perm_cor(perms = 1000, Fr$Urban, Fr$HIV)
AFRresults
FRresults
afrmean <- mean(AFRresults)
frmean <- mean(FRresults)
afrmean
frmean
bdata<-tdata%>%select(-HIV)
bmodel<-lm(Life_exp~GDPpc,data=bdata)
bdata<-add_residuals(bdata,model=bmodel,var="resid_le")
bdata
ggplot(bdata,aes(x=Literacy,y=Life_exp,color=log(GDPpc,base = 10)))+geom_point()+geom_smooth(se=F,color="red")+labs(title="Literacy, Life Expectancy and GDP per capita",
x="Literacy Rate",
y="Life Expectancy",
color="Base 10 Log of GDP",
caption="Log used to show order of magnitude since it spans many orders of magnitude")
ggplot(bdata,aes(x=Literacy,y=resid_le))+geom_jitter()+geom_smooth(se=F,color="red")+labs(title="Literacy and Residuals of Life Expectancy",
caption="Residuals Generated After removing effect of GDP per Capita",
x="Literacy Rate",y="Residuals")
ggplot(bdata,aes(x=Literacy,y=resid_le))+geom_jitter()+geom_smooth(se=F,color="red")+xlim(85,100)+labs(title="Literacy and Residuals of Life Expectancy", subtitle = "Zoomed into 85-100% Literacy",
caption="Residuals Generated After removing effect of GDP per Capita",
x="Literacy Rate",y="Residuals")
bmodel2<-lm(Life_exp~GDPpc+Literacy,data=bdata)
print("Coefficients of Linear Model Including Per Capita GDP and Literacty Rate")
tibble(Measurement=c("Intercept","GDP per Capita", "Literacy Rate"),"Coefficient Value"= coef(bmodel2))
high_le<-bdata%>%filter(Life_exp>median(bdata$Life_exp,na.rm=T))
low_le<-bdata%>%filter(Life_exp<=median(bdata$Life_exp,na.rm=T))
c_mean_diff<-mean(high_le$Literacy,na.rm=T)-mean(low_le$Literacy,na.rm=T)
permuted_means<-tibble(lit_mean_diff=perm_mean(perms=1000,all_values = c(low_le$Literacy,high_le$Literacy),n_A=nrow(high_le)))
p2.5<-quantile(permuted_means$lit_mean_diff, probs=.025)[[1]]
p97.5<-quantile(permuted_means$lit_mean_diff, probs=.975)[[1]]
ggplot(data=permuted_means,aes(lit_mean_diff,fill=(lit_mean_diff<p2.5|lit_mean_diff>p97.5)))+geom_histogram()+geom_vline(xintercept = c_mean_diff)+
labs(title="Permuted Difference of Means",fill="Tails",x="Difference of the Means of Literacy")
percentile<-nrow(filter(permuted_means,lit_mean_diff<c_mean_diff))/nrow(permuted_means)
print(paste("The Computed difference of Means is in the ",percentile*100,"th percentile",sep = ""))
resids<-bdata$resid_le
lit<-bdata$Literacy
calculated_correlation<-cor(lit,resids,use="pairwise.complete.obs")
permuted_correlations<-tibble(correlations=perm_cor(perms=1000,lit,resids))
p2.5<-quantile(permuted_correlations$correlations, probs=.025)[[1]]
p97.5<-quantile(permuted_correlations$correlations, probs=.975)[[1]]
ggplot(data=permuted_correlations,aes(correlations,fill=(correlations<p2.5|correlations>p97.5)))+geom_histogram()+geom_vline(xintercept = calculated_correlation)+
labs(title="Permuted Correlations Between Literacy and Life Expectancy",x="Correlations",fill="Tails")
percentile<-nrow(filter(permuted_correlations,correlations<calculated_correlation))/nrow(permuted_correlations)
print(paste("The Computed Correlation is in the ",percentile*100,"th percentile",sep = ""))
lit<-tdata$Literacy
HIV<-tdata$HIV
lifeExp<-tdata$Life_exp
cor_lit_HIV<-cor(lit,HIV,use = "pairwise.complete.obs")
cor_le_HIV<-cor(HIV,lifeExp,use="pairwise.complete.obs")
pc_lit_HIV<-tibble(cor=perm_cor(perms=1000,lit,HIV))
pc_le_HIV<-tibble(cor=perm_cor(perms=1000,HIV,lifeExp))
plow_lit_HIV<-quantile(pc_lit_HIV$cor,probs=.025)[[1]]
phigh_lit_HIV<-quantile(pc_lit_HIV$cor,probs=.975)[[1]]
plow_HIV_le<-quantile(pc_HIV_le$cor,probs=.025)[[1]]
phigh_HIV_le<-quantile(pc_HIV_le$cor,probs=.975)[[1]]
ggplot(pc_lit_HIV,aes(cor,fill=(cor<plow_lit_HIV|cor>phigh_lit_HIV)))+geom_histogram(binwidth = .01)+geom_vline(xintercept = cor_lit_HIV)+
labs(title="Literacy rate and Female HIV rate Permutation Correlation Test",
x="Correlation Between Literacy rate and Female HIV rate",
fill="Tails")
ggplot(pc_HIV_le,aes(cor,fill=(cor<plow_HIV_le|cor>phigh_HIV_le)))+geom_histogram(binwidth = .01)+geom_vline(xintercept = cor_HIV_le)+
labs(title="Female HIV rate and Life Expectancy permutation Correlation Test",
x="Correlation between Female HIV rate and Life Expectancy",
fill="Tails")
percentile_lit_le<-nrow(filter(pc_lit_HIV,cor<cor_lit_HIV))/nrow(pc_lit_HIV)
percentile_HIV_le<-nrow(filter(pc_HIV_le,cor<cor_HIV_le))/nrow(pc_HIV_le)
ptable<-tibble("Percentile of:"=c("Literacy Rate and Female HIV Rate Permutation Correlation Test","Female HIV Rate and Life Expectancy Permutation Correlation Test"),"Value:"=
c(percentile_lit_HIV,percentile_HIV_le))
lit<-tdata$Literacy
HIV<-tdata$HIV
lifeExp<-tdata$Life_exp
cor_lit_HIV<-cor(lit,HIV,use = "pairwise.complete.obs")
cor_le_HIV<-cor(HIV,lifeExp,use="pairwise.complete.obs")
pc_lit_HIV<-tibble(cor=perm_cor(perms=1000,lit,HIV))
pc_le_HIV<-tibble(cor=perm_cor(perms=1000,HIV,lifeExp))
plow_lit_HIV<-quantile(pc_lit_HIV$cor,probs=.025)[[1]]
phigh_lit_HIV<-quantile(pc_lit_HIV$cor,probs=.975)[[1]]
plow_HIV_le<-quantile(pc_HIV_le$cor,probs=.025)[[1]]
phigh_HIV_le<-quantile(pc_HIV_le$cor,probs=.975)[[1]]
ggplot(pc_lit_HIV,aes(cor,fill=(cor<plow_lit_HIV|cor>phigh_lit_HIV)))+geom_histogram(binwidth = .01)+geom_vline(xintercept = cor_lit_HIV)+
labs(title="Literacy rate and Female HIV rate Permutation Correlation Test",
x="Correlation Between Literacy rate and Female HIV rate",
fill="Tails")
ggplot(pc_HIV_le,aes(cor,fill=(cor<plow_HIV_le|cor>phigh_HIV_le)))+geom_histogram(binwidth = .01)+geom_vline(xintercept = cor_HIV_le)+
labs(title="Female HIV rate and Life Expectancy permutation Correlation Test",
x="Correlation between Female HIV rate and Life Expectancy",
fill="Tails")
percentile_lit_HIV<-nrow(filter(pc_lit_HIV,cor<cor_lit_HIV))/nrow(pc_lit_HIV)
percentile_HIV_le<-nrow(filter(pc_HIV_le,cor<cor_HIV_le))/nrow(pc_HIV_le)
ptable<-tibble("Percentile of:"=c("Literacy Rate and Female HIV Rate Permutation Correlation Test","Female HIV Rate and Life Expectancy Permutation Correlation Test"),"Value:"=
c(percentile_lit_HIV,percentile_HIV_le))
ptable
AFsample <- urbanHIV %>% filter(year <= "2006") %>% filter(Country == "South Africa" | Country == "Mongolia" | Country == "Central African Republic" | Country == "Ethiopia")
AFRresults <- perm_cor(perms = 1000, AFsample$Urban, AFsample$HIV)
FRresults <- perm_cor(perms = 1000, Fr$Urban, Fr$HIV)
#AFRresults
#FRresults
lit<-tdata$Literacy
HIV<-tdata$HIV
lifeExp<-tdata$Life_exp
cor_lit_HIV<-cor(lit,HIV,use = "pairwise.complete.obs")
cor_le_HIV<-cor(HIV,lifeExp,use="pairwise.complete.obs")
pc_lit_HIV<-tibble(cor=perm_cor(perms=1000,lit,HIV))
pc_le_HIV<-tibble(cor=perm_cor(perms=1000,HIV,lifeExp))
plow_lit_HIV<-quantile(pc_lit_HIV$cor,probs=.025)[[1]]
phigh_lit_HIV<-quantile(pc_lit_HIV$cor,probs=.975)[[1]]
plow_HIV_le<-quantile(pc_HIV_le$cor,probs=.025)[[1]]
phigh_HIV_le<-quantile(pc_HIV_le$cor,probs=.975)[[1]]
ggplot(pc_lit_HIV,aes(cor,fill=(cor<plow_lit_HIV|cor>phigh_lit_HIV)))+geom_histogram(binwidth = .01)+geom_vline(xintercept = cor_lit_HIV)+
labs(title="Literacy rate and Female HIV rate Permutation Correlation Test",
x="Correlation Between Literacy rate and Female HIV rate",
fill="Tails")
ggplot(pc_HIV_le,aes(cor,fill=(cor<plow_HIV_le|cor>phigh_HIV_le)))+geom_histogram(binwidth = .01)+geom_vline(xintercept = cor_HIV_le)+
labs(title="Female HIV rate and Life Expectancy permutation Correlation Test",
x="Correlation between Female HIV rate and Life Expectancy",
fill="Tails")
percentile_lit_HIV<-nrow(filter(pc_lit_HIV,cor<cor_lit_HIV))/nrow(pc_lit_HIV)
percentile_HIV_le<-nrow(filter(pc_HIV_le,cor<cor_HIV_le))/nrow(pc_HIV_le)
ptable<-tibble("Percentile of:"=c("Literacy Rate and Female HIV Rate Permutation Correlation Test","Female HIV Rate and Life Expectancy Permutation Correlation Test"),"Value:"=
c(percentile_lit_HIV,percentile_HIV_le))
ptable
lit<-tdata$Literacy
HIV<-tdata$HIV
lifeExp<-tdata$Life_exp
cor_lit_HIV<-cor(lit,HIV,use = "pairwise.complete.obs")
cor_le_HIV<-cor(HIV,lifeExp,use="pairwise.complete.obs")
pc_lit_HIV<-tibble(cor=perm_cor(perms=1000,lit,HIV))
pc_HIV_le<-tibble(cor=perm_cor(perms=1000,HIV,lifeExp))
plow_lit_HIV<-quantile(pc_lit_HIV$cor,probs=.025)[[1]]
phigh_lit_HIV<-quantile(pc_lit_HIV$cor,probs=.975)[[1]]
plow_HIV_le<-quantile(pc_HIV_le$cor,probs=.025)[[1]]
phigh_HIV_le<-quantile(pc_HIV_le$cor,probs=.975)[[1]]
ggplot(pc_lit_HIV,aes(cor,fill=(cor<plow_lit_HIV|cor>phigh_lit_HIV)))+geom_histogram(binwidth = .01)+geom_vline(xintercept = cor_lit_HIV)+
labs(title="Literacy rate and Female HIV rate Permutation Correlation Test",
x="Correlation Between Literacy rate and Female HIV rate",
fill="Tails")
ggplot(pc_HIV_le,aes(cor,fill=(cor<plow_HIV_le|cor>phigh_HIV_le)))+geom_histogram(binwidth = .01)+geom_vline(xintercept = cor_HIV_le)+
labs(title="Female HIV rate and Life Expectancy permutation Correlation Test",
x="Correlation between Female HIV rate and Life Expectancy",
fill="Tails")
percentile_lit_HIV<-nrow(filter(pc_lit_HIV,cor<cor_lit_HIV))/nrow(pc_lit_HIV)
percentile_HIV_le<-nrow(filter(pc_HIV_le,cor<cor_HIV_le))/nrow(pc_HIV_le)
ptable<-tibble("Percentile of:"=c("Literacy Rate and Female HIV Rate Permutation Correlation Test","Female HIV Rate and Life Expectancy Permutation Correlation Test"),"Value:"=
c(percentile_lit_HIV,percentile_HIV_le))
ptable
lit<-tdata$Literacy
HIV<-tdata$HIV
lifeExp<-tdata$Life_exp
cor_lit_HIV<-cor(lit,HIV,use = "pairwise.complete.obs")
cor_HIV_le<-cor(HIV,lifeExp,use="pairwise.complete.obs")
pc_lit_HIV<-tibble(cor=perm_cor(perms=1000,lit,HIV))
pc_HIV_le<-tibble(cor=perm_cor(perms=1000,HIV,lifeExp))
plow_lit_HIV<-quantile(pc_lit_HIV$cor,probs=.025)[[1]]
phigh_lit_HIV<-quantile(pc_lit_HIV$cor,probs=.975)[[1]]
plow_HIV_le<-quantile(pc_HIV_le$cor,probs=.025)[[1]]
phigh_HIV_le<-quantile(pc_HIV_le$cor,probs=.975)[[1]]
ggplot(pc_lit_HIV,aes(cor,fill=(cor<plow_lit_HIV|cor>phigh_lit_HIV)))+geom_histogram(binwidth = .01)+geom_vline(xintercept = cor_lit_HIV)+
labs(title="Literacy rate and Female HIV rate Permutation Correlation Test",
x="Correlation Between Literacy rate and Female HIV rate",
fill="Tails")
ggplot(pc_HIV_le,aes(cor,fill=(cor<plow_HIV_le|cor>phigh_HIV_le)))+geom_histogram(binwidth = .01)+geom_vline(xintercept = cor_HIV_le)+
labs(title="Female HIV rate and Life Expectancy permutation Correlation Test",
x="Correlation between Female HIV rate and Life Expectancy",
fill="Tails")
percentile_lit_HIV<-nrow(filter(pc_lit_HIV,cor<cor_lit_HIV))/nrow(pc_lit_HIV)
percentile_HIV_le<-nrow(filter(pc_HIV_le,cor<cor_HIV_le))/nrow(pc_HIV_le)
ptable<-tibble("Percentile of:"=c("Literacy Rate and Female HIV Rate Permutation Correlation Test","Female HIV Rate and Life Expectancy Permutation Correlation Test"),"Value:"=
c(percentile_lit_HIV,percentile_HIV_le))
ptable
