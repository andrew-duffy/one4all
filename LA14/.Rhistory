labs(title="",fill="Tails")+
geom_vline(xintercept=smoke_calc_mean_diff)+labs()
percentile=nrow(filter(smokepermuted,differences<smoke_calc_mean_diff))/nrow(smokepermuted)
tibble(Percentile=percentile)
cdc_modified<-cdc%>%mutate(smoke100L=as.logical(smoke100))%>%mutate(hlthcoded=ifelse(genhlth=="excellent",5,
ifelse(genhlth=="very good",4,
ifelse(genhlth=="good",3,
ifelse(genhlth=="fair",2,
ifelse(genhlth=="poor",1,NA))))))
ggplot(data=cdc_modified,aes(hlthcoded,color=smoke100L))+geom_freqpoly()
smokers<-tdata%>%filter(smoke100==1)
nonsmokers<-tdata%>%filter(smoke100==0)
smoke_calc_mean_diff<-mean(nonsmokers$hlthcoded)-mean(smokers$hlthcoded)
smokepermuted<-tibble(differences=perm_mean(perms=1000,all_values = tdata$hlthcoded,n_A = nrow(nonsmokers)))
ggplot(data=smokepermuted,aes(differences))+
geom_histogram(binwidth=.002,aes(fill=(differences<quantile(differences,probs = c(.025))[[1]]|differences>quantile(differences,probs = c(.975))[[1]])))+
labs(title="",fill="Tails")+
geom_vline(xintercept=smoke_calc_mean_diff)+labs()
percentile=nrow(filter(smokepermuted,differences<smoke_calc_mean_diff))/nrow(smokepermuted)
tibble(Percentile=percentile)
cdc_modified<-cdc%>%mutate(smoke100L=as.logical(smoke100))%>%mutate(hlthcoded=ifelse(genhlth=="excellent",5,
ifelse(genhlth=="very good",4,
ifelse(genhlth=="good",3,
ifelse(genhlth=="fair",2,
ifelse(genhlth=="poor",1,NA))))))
ggplot(data=cdc_modified,aes(hlthcoded,color=smoke100L))+geom_freqpoly()+labs(title="Smoking and General Health",color="Has Smoked",x="General Health (1=poor,5=excellent")
smokers<-tdata%>%filter(smoke100==1)
nonsmokers<-tdata%>%filter(smoke100==0)
smoke_calc_mean_diff<-mean(nonsmokers$hlthcoded)-mean(smokers$hlthcoded)
smokepermuted<-tibble(differences=perm_mean(perms=1000,all_values = tdata$hlthcoded,n_A = nrow(nonsmokers)))
ggplot(data=smokepermuted,aes(differences))+
geom_histogram(binwidth=.002,aes(fill=(differences<quantile(differences,probs = c(.025))[[1]]|differences>quantile(differences,probs = c(.975))[[1]])))+
labs(title="",fill="Tails")+
geom_vline(xintercept=smoke_calc_mean_diff)+labs()
percentile=nrow(filter(smokepermuted,differences<smoke_calc_mean_diff))/nrow(smokepermuted)
tibble(Percentile=percentile)
cdc_modified<-cdc%>%mutate(smoke100L=as.logical(smoke100))%>%mutate(hlthcoded=ifelse(genhlth=="excellent",5,
ifelse(genhlth=="very good",4,
ifelse(genhlth=="good",3,
ifelse(genhlth=="fair",2,
ifelse(genhlth=="poor",1,NA))))))
ggplot(data=cdc_modified,aes(hlthcoded,y=..prop..,color=smoke100L))+geom_freqpoly()+labs(title="Smoking and General Health",color="Has Smoked",x="General Health (1=poor,5=excellent)")
smokers<-tdata%>%filter(smoke100==1)
nonsmokers<-tdata%>%filter(smoke100==0)
smoke_calc_mean_diff<-mean(nonsmokers$hlthcoded)-mean(smokers$hlthcoded)
smokepermuted<-tibble(differences=perm_mean(perms=1000,all_values = tdata$hlthcoded,n_A = nrow(nonsmokers)))
ggplot(data=smokepermuted,aes(differences))+
geom_histogram(binwidth=.002,aes(fill=(differences<quantile(differences,probs = c(.025))[[1]]|differences>quantile(differences,probs = c(.975))[[1]])))+
labs(title="",fill="Tails")+
geom_vline(xintercept=smoke_calc_mean_diff)+labs()
percentile=nrow(filter(smokepermuted,differences<smoke_calc_mean_diff))/nrow(smokepermuted)
tibble(Percentile=percentile)
cdc_modified<-cdc%>%mutate(smoke100L=as.logical(smoke100))%>%mutate(hlthcoded=ifelse(genhlth=="excellent",5,
ifelse(genhlth=="very good",4,
ifelse(genhlth=="good",3,
ifelse(genhlth=="fair",2,
ifelse(genhlth=="poor",1,NA))))))
ggplot(data=cdc_modified,aes(hlthcoded,stat(density),color=smoke100L))+geom_freqpoly()+labs(title="Smoking and General Health",color="Has Smoked",x="General Health (1=poor,5=excellent)")
smokers<-tdata%>%filter(smoke100==1)
nonsmokers<-tdata%>%filter(smoke100==0)
smoke_calc_mean_diff<-mean(nonsmokers$hlthcoded)-mean(smokers$hlthcoded)
smokepermuted<-tibble(differences=perm_mean(perms=1000,all_values = tdata$hlthcoded,n_A = nrow(nonsmokers)))
ggplot(data=smokepermuted,aes(differences))+
geom_histogram(binwidth=.002,aes(fill=(differences<quantile(differences,probs = c(.025))[[1]]|differences>quantile(differences,probs = c(.975))[[1]])))+
labs(title="",fill="Tails")+
geom_vline(xintercept=smoke_calc_mean_diff)+labs()
percentile=nrow(filter(smokepermuted,differences<smoke_calc_mean_diff))/nrow(smokepermuted)
tibble(Percentile=percentile)
cdc_modified<-cdc%>%mutate(smoke100L=as.logical(smoke100))%>%mutate(hlthcoded=ifelse(genhlth=="excellent",5,
ifelse(genhlth=="very good",4,
ifelse(genhlth=="good",3,
ifelse(genhlth=="fair",2,
ifelse(genhlth=="poor",1,NA))))))
ggplot(data=cdc_modified,aes(hlthcoded,stat(density),color=smoke100L))+geom_freqpoly(size=1)+labs(title="Smoking and General Health",color="Has Smoked",x="General Health (1=poor,5=excellent)")
smokers<-tdata%>%filter(smoke100==1)
nonsmokers<-tdata%>%filter(smoke100==0)
smoke_calc_mean_diff<-mean(nonsmokers$hlthcoded)-mean(smokers$hlthcoded)
smokepermuted<-tibble(differences=perm_mean(perms=1000,all_values = tdata$hlthcoded,n_A = nrow(nonsmokers)))
ggplot(data=smokepermuted,aes(differences))+
geom_histogram(binwidth=.002,aes(fill=(differences<quantile(differences,probs = c(.025))[[1]]|differences>quantile(differences,probs = c(.975))[[1]])))+
labs(title="",fill="Tails")+
geom_vline(xintercept=smoke_calc_mean_diff)+labs()
percentile=nrow(filter(smokepermuted,differences<smoke_calc_mean_diff))/nrow(smokepermuted)
tibble(Percentile=percentile)
cdc_modified<-cdc%>%mutate(smoke100L=as.logical(smoke100))%>%mutate(hlthcoded=ifelse(genhlth=="excellent",5,
ifelse(genhlth=="very good",4,
ifelse(genhlth=="good",3,
ifelse(genhlth=="fair",2,
ifelse(genhlth=="poor",1,NA))))))
ggplot(data=cdc_modified,aes(hlthcoded,stat(density),color=smoke100L))+geom_freqpoly(size=1.5)+labs(title="Smoking and General Health",color="Has Smoked",x="General Health (1=poor,5=excellent)")
smokers<-tdata%>%filter(smoke100==1)
nonsmokers<-tdata%>%filter(smoke100==0)
smoke_calc_mean_diff<-mean(nonsmokers$hlthcoded)-mean(smokers$hlthcoded)
smokepermuted<-tibble(differences=perm_mean(perms=1000,all_values = tdata$hlthcoded,n_A = nrow(nonsmokers)))
ggplot(data=smokepermuted,aes(differences))+
geom_histogram(binwidth=.002,aes(fill=(differences<quantile(differences,probs = c(.025))[[1]]|differences>quantile(differences,probs = c(.975))[[1]])))+
labs(title="",fill="Tails")+
geom_vline(xintercept=smoke_calc_mean_diff)+labs()
percentile=nrow(filter(smokepermuted,differences<smoke_calc_mean_diff))/nrow(smokepermuted)
tibble(Percentile=percentile)
cdc_modified<-cdc%>%mutate(smoke100L=as.logical(smoke100))%>%mutate(hlthcoded=ifelse(genhlth=="excellent",5,
ifelse(genhlth=="very good",4,
ifelse(genhlth=="good",3,
ifelse(genhlth=="fair",2,
ifelse(genhlth=="poor",1,NA))))))
ggplot(data=cdc_modified,aes(hlthcoded,stat(density),color=smoke100L))+geom_freqpoly(size=1.5,alpha=.7)+labs(title="Smoking and General Health",color="Has Smoked",x="General Health (1=poor,5=excellent)")
smokers<-tdata%>%filter(smoke100==1)
nonsmokers<-tdata%>%filter(smoke100==0)
smoke_calc_mean_diff<-mean(nonsmokers$hlthcoded)-mean(smokers$hlthcoded)
smokepermuted<-tibble(differences=perm_mean(perms=1000,all_values = tdata$hlthcoded,n_A = nrow(nonsmokers)))
ggplot(data=smokepermuted,aes(differences))+
geom_histogram(binwidth=.002,aes(fill=(differences<quantile(differences,probs = c(.025))[[1]]|differences>quantile(differences,probs = c(.975))[[1]])))+
labs(title="",fill="Tails")+
geom_vline(xintercept=smoke_calc_mean_diff)+labs()
percentile=nrow(filter(smokepermuted,differences<smoke_calc_mean_diff))/nrow(smokepermuted)
tibble(Percentile=percentile)
cdc_modified<-cdc%>%mutate(smoke100L=as.logical(smoke100))%>%mutate(hlthcoded=ifelse(genhlth=="excellent",5,
ifelse(genhlth=="very good",4,
ifelse(genhlth=="good",3,
ifelse(genhlth=="fair",2,
ifelse(genhlth=="poor",1,NA))))))
ggplot(data=cdc_modified,aes(genhlth,stat(density),color=smoke100L))+geom_bar()+labs(title="Smoking and General Health",color="Has Smoked",x="General Health (1=poor,5=excellent)")
smokers<-tdata%>%filter(smoke100==1)
nonsmokers<-tdata%>%filter(smoke100==0)
smoke_calc_mean_diff<-mean(nonsmokers$hlthcoded)-mean(smokers$hlthcoded)
smokepermuted<-tibble(differences=perm_mean(perms=1000,all_values = tdata$hlthcoded,n_A = nrow(nonsmokers)))
ggplot(data=smokepermuted,aes(differences))+
geom_histogram(binwidth=.002,aes(fill=(differences<quantile(differences,probs = c(.025))[[1]]|differences>quantile(differences,probs = c(.975))[[1]])))+
labs(title="",fill="Tails")+
geom_vline(xintercept=smoke_calc_mean_diff)+labs()
percentile=nrow(filter(smokepermuted,differences<smoke_calc_mean_diff))/nrow(smokepermuted)
tibble(Percentile=percentile)
cdc_modified<-cdc%>%mutate(smoke100L=as.logical(smoke100))%>%mutate(hlthcoded=ifelse(genhlth=="excellent",5,
ifelse(genhlth=="very good",4,
ifelse(genhlth=="good",3,
ifelse(genhlth=="fair",2,
ifelse(genhlth=="poor",1,NA))))))
ggplot(data=cdc_modified,aes(genhlth,y=..prop..,color=smoke100L))+geom_bar()+labs(title="Smoking and General Health",color="Has Smoked",x="General Health (1=poor,5=excellent)")
smokers<-tdata%>%filter(smoke100==1)
nonsmokers<-tdata%>%filter(smoke100==0)
smoke_calc_mean_diff<-mean(nonsmokers$hlthcoded)-mean(smokers$hlthcoded)
smokepermuted<-tibble(differences=perm_mean(perms=1000,all_values = tdata$hlthcoded,n_A = nrow(nonsmokers)))
ggplot(data=smokepermuted,aes(differences))+
geom_histogram(binwidth=.002,aes(fill=(differences<quantile(differences,probs = c(.025))[[1]]|differences>quantile(differences,probs = c(.975))[[1]])))+
labs(title="",fill="Tails")+
geom_vline(xintercept=smoke_calc_mean_diff)+labs()
percentile=nrow(filter(smokepermuted,differences<smoke_calc_mean_diff))/nrow(smokepermuted)
tibble(Percentile=percentile)
cdc_modified<-cdc%>%mutate(smoke100L=as.logical(smoke100))%>%mutate(hlthcoded=ifelse(genhlth=="excellent",5,
ifelse(genhlth=="very good",4,
ifelse(genhlth=="good",3,
ifelse(genhlth=="fair",2,
ifelse(genhlth=="poor",1,NA))))))
ggplot(data=cdc_modified,aes(genhlth,y=..prop..,fill=smoke100L))+geom_bar(position="dodge")+labs(title="Smoking and General Health",color="Has Smoked",x="General Health (1=poor,5=excellent)")
smokers<-tdata%>%filter(smoke100==1)
nonsmokers<-tdata%>%filter(smoke100==0)
smoke_calc_mean_diff<-mean(nonsmokers$hlthcoded)-mean(smokers$hlthcoded)
smokepermuted<-tibble(differences=perm_mean(perms=1000,all_values = tdata$hlthcoded,n_A = nrow(nonsmokers)))
ggplot(data=smokepermuted,aes(differences))+
geom_histogram(binwidth=.002,aes(fill=(differences<quantile(differences,probs = c(.025))[[1]]|differences>quantile(differences,probs = c(.975))[[1]])))+
labs(title="",fill="Tails")+
geom_vline(xintercept=smoke_calc_mean_diff)+labs()
percentile=nrow(filter(smokepermuted,differences<smoke_calc_mean_diff))/nrow(smokepermuted)
tibble(Percentile=percentile)
cdc_modified<-cdc%>%mutate(smoke100L=as.logical(smoke100))%>%mutate(hlthcoded=ifelse(genhlth=="excellent",5,
ifelse(genhlth=="very good",4,
ifelse(genhlth=="good",3,
ifelse(genhlth=="fair",2,
ifelse(genhlth=="poor",1,NA))))))
ggplot(data=cdc_modified,aes(genhlth,fill=smoke100L))+geom_bar(position="dodge")+labs(title="Smoking and General Health",color="Has Smoked",x="General Health (1=poor,5=excellent)")
smokers<-tdata%>%filter(smoke100==1)
nonsmokers<-tdata%>%filter(smoke100==0)
smoke_calc_mean_diff<-mean(nonsmokers$hlthcoded)-mean(smokers$hlthcoded)
smokepermuted<-tibble(differences=perm_mean(perms=1000,all_values = tdata$hlthcoded,n_A = nrow(nonsmokers)))
ggplot(data=smokepermuted,aes(differences))+
geom_histogram(binwidth=.002,aes(fill=(differences<quantile(differences,probs = c(.025))[[1]]|differences>quantile(differences,probs = c(.975))[[1]])))+
labs(title="",fill="Tails")+
geom_vline(xintercept=smoke_calc_mean_diff)+labs()
percentile=nrow(filter(smokepermuted,differences<smoke_calc_mean_diff))/nrow(smokepermuted)
tibble(Percentile=percentile)
cdc_modified<-cdc%>%mutate(smoke100L=as.logical(smoke100))%>%mutate(hlthcoded=ifelse(genhlth=="excellent",5,
ifelse(genhlth=="very good",4,
ifelse(genhlth=="good",3,
ifelse(genhlth=="fair",2,
ifelse(genhlth=="poor",1,NA))))))
ggplot(data=cdc_modified,aes(genhlth,fill=smoke100L))+geom_bar(position="dodge")+labs(title="Smoking and General Health",fill="Has Smoked",x="General Health (1=poor,5=excellent)")
smokers<-tdata%>%filter(smoke100==1)
nonsmokers<-tdata%>%filter(smoke100==0)
smoke_calc_mean_diff<-mean(nonsmokers$hlthcoded)-mean(smokers$hlthcoded)
smokepermuted<-tibble(differences=perm_mean(perms=1000,all_values = tdata$hlthcoded,n_A = nrow(nonsmokers)))
ggplot(data=smokepermuted,aes(differences))+
geom_histogram(binwidth=.002,aes(fill=(differences<quantile(differences,probs = c(.025))[[1]]|differences>quantile(differences,probs = c(.975))[[1]])))+
labs(title="",fill="Tails")+
geom_vline(xintercept=smoke_calc_mean_diff)+labs()
percentile=nrow(filter(smokepermuted,differences<smoke_calc_mean_diff))/nrow(smokepermuted)
tibble(Percentile=percentile)
cdc_modified<-cdc%>%mutate(smoke100L=as.logical(smoke100))%>%mutate(hlthcoded=ifelse(genhlth=="excellent",5,
ifelse(genhlth=="very good",4,
ifelse(genhlth=="good",3,
ifelse(genhlth=="fair",2,
ifelse(genhlth=="poor",1,NA))))))
ggplot(data=cdc_modified,aes(genhlth,fill=smoke100L,y=..prop..))+geom_bar(position="dodge")+labs(title="Smoking and General Health",fill="Has Smoked",x="General Health (1=poor,5=excellent)")
smokers<-tdata%>%filter(smoke100==1)
nonsmokers<-tdata%>%filter(smoke100==0)
smoke_calc_mean_diff<-mean(nonsmokers$hlthcoded)-mean(smokers$hlthcoded)
smokepermuted<-tibble(differences=perm_mean(perms=1000,all_values = tdata$hlthcoded,n_A = nrow(nonsmokers)))
ggplot(data=smokepermuted,aes(differences))+
geom_histogram(binwidth=.002,aes(fill=(differences<quantile(differences,probs = c(.025))[[1]]|differences>quantile(differences,probs = c(.975))[[1]])))+
labs(title="",fill="Tails")+
geom_vline(xintercept=smoke_calc_mean_diff)+labs()
percentile=nrow(filter(smokepermuted,differences<smoke_calc_mean_diff))/nrow(smokepermuted)
tibble(Percentile=percentile)
cdc_modified<-cdc%>%mutate(smoke100L=as.logical(smoke100))%>%mutate(hlthcoded=ifelse(genhlth=="excellent",5,
ifelse(genhlth=="very good",4,
ifelse(genhlth=="good",3,
ifelse(genhlth=="fair",2,
ifelse(genhlth=="poor",1,NA))))))
ggplot(data=cdc_modified,aes(genhlth,fill=smoke100L))+geom_bar(position="dodge")+labs(title="Smoking and General Health",fill="Has Smoked",x="General Health (1=poor,5=excellent)")
smokers<-tdata%>%filter(smoke100==1)
nonsmokers<-tdata%>%filter(smoke100==0)
smoke_calc_mean_diff<-mean(nonsmokers$hlthcoded)-mean(smokers$hlthcoded)
smokepermuted<-tibble(differences=perm_mean(perms=1000,all_values = tdata$hlthcoded,n_A = nrow(nonsmokers)))
ggplot(data=smokepermuted,aes(differences))+
geom_histogram(binwidth=.002,aes(fill=(differences<quantile(differences,probs = c(.025))[[1]]|differences>quantile(differences,probs = c(.975))[[1]])))+
labs(title="",fill="Tails")+
geom_vline(xintercept=smoke_calc_mean_diff)+labs()
percentile=nrow(filter(smokepermuted,differences<smoke_calc_mean_diff))/nrow(smokepermuted)
tibble(Percentile=percentile)
cdc_modified<-cdc%>%mutate(smoke100L=as.logical(smoke100))%>%mutate(hlthcoded=ifelse(genhlth=="excellent",5,
ifelse(genhlth=="very good",4,
ifelse(genhlth=="good",3,
ifelse(genhlth=="fair",2,
ifelse(genhlth=="poor",1,NA))))))
ggplot(data=cdc_modified,aes(genhlth,fill=smoke100L,y=..prop..,group=1))+geom_bar(position="dodge")+labs(title="Smoking and General Health",fill="Has Smoked",x="General Health (1=poor,5=excellent)")
smokers<-tdata%>%filter(smoke100==1)
nonsmokers<-tdata%>%filter(smoke100==0)
smoke_calc_mean_diff<-mean(nonsmokers$hlthcoded)-mean(smokers$hlthcoded)
smokepermuted<-tibble(differences=perm_mean(perms=1000,all_values = tdata$hlthcoded,n_A = nrow(nonsmokers)))
ggplot(data=smokepermuted,aes(differences))+
geom_histogram(binwidth=.002,aes(fill=(differences<quantile(differences,probs = c(.025))[[1]]|differences>quantile(differences,probs = c(.975))[[1]])))+
labs(title="",fill="Tails")+
geom_vline(xintercept=smoke_calc_mean_diff)+labs()
percentile=nrow(filter(smokepermuted,differences<smoke_calc_mean_diff))/nrow(smokepermuted)
tibble(Percentile=percentile)
cdc_modified<-cdc%>%mutate(smoke100L=as.logical(smoke100))%>%mutate(hlthcoded=ifelse(genhlth=="excellent",5,
ifelse(genhlth=="very good",4,
ifelse(genhlth=="good",3,
ifelse(genhlth=="fair",2,
ifelse(genhlth=="poor",1,NA))))))
ggplot(data=cdc_modified,aes(genhlth,fill=smoke100L,y=..prop..,group=2))+geom_bar(position="dodge")+labs(title="Smoking and General Health",fill="Has Smoked",x="General Health (1=poor,5=excellent)")
smokers<-tdata%>%filter(smoke100==1)
nonsmokers<-tdata%>%filter(smoke100==0)
smoke_calc_mean_diff<-mean(nonsmokers$hlthcoded)-mean(smokers$hlthcoded)
smokepermuted<-tibble(differences=perm_mean(perms=1000,all_values = tdata$hlthcoded,n_A = nrow(nonsmokers)))
ggplot(data=smokepermuted,aes(differences))+
geom_histogram(binwidth=.002,aes(fill=(differences<quantile(differences,probs = c(.025))[[1]]|differences>quantile(differences,probs = c(.975))[[1]])))+
labs(title="",fill="Tails")+
geom_vline(xintercept=smoke_calc_mean_diff)+labs()
percentile=nrow(filter(smokepermuted,differences<smoke_calc_mean_diff))/nrow(smokepermuted)
tibble(Percentile=percentile)
cdc_modified<-cdc%>%mutate(smoke100L=as.logical(smoke100))%>%mutate(hlthcoded=ifelse(genhlth=="excellent",5,
ifelse(genhlth=="very good",4,
ifelse(genhlth=="good",3,
ifelse(genhlth=="fair",2,
ifelse(genhlth=="poor",1,NA))))))
ggplot(data=cdc_modified,aes(genhlth,fill=smoke100L,y=..prop..,group=10))+geom_bar(position="dodge")+labs(title="Smoking and General Health",fill="Has Smoked",x="General Health (1=poor,5=excellent)")
smokers<-tdata%>%filter(smoke100==1)
nonsmokers<-tdata%>%filter(smoke100==0)
smoke_calc_mean_diff<-mean(nonsmokers$hlthcoded)-mean(smokers$hlthcoded)
smokepermuted<-tibble(differences=perm_mean(perms=1000,all_values = tdata$hlthcoded,n_A = nrow(nonsmokers)))
ggplot(data=smokepermuted,aes(differences))+
geom_histogram(binwidth=.002,aes(fill=(differences<quantile(differences,probs = c(.025))[[1]]|differences>quantile(differences,probs = c(.975))[[1]])))+
labs(title="",fill="Tails")+
geom_vline(xintercept=smoke_calc_mean_diff)+labs()
percentile=nrow(filter(smokepermuted,differences<smoke_calc_mean_diff))/nrow(smokepermuted)
tibble(Percentile=percentile)
cdc_modified<-cdc%>%mutate(smoke100L=as.logical(smoke100))%>%mutate(hlthcoded=ifelse(genhlth=="excellent",5,
ifelse(genhlth=="very good",4,
ifelse(genhlth=="good",3,
ifelse(genhlth=="fair",2,
ifelse(genhlth=="poor",1,NA))))))
ggplot(data=cdc_modified,aes(genhlth,fill=smoke100L))+geom_bar(position="dodge")+labs(title="Smoking and General Health",fill="Has Smoked",x="General Health (1=poor,5=excellent)")
smokers<-tdata%>%filter(smoke100==1)
nonsmokers<-tdata%>%filter(smoke100==0)
smoke_calc_mean_diff<-mean(nonsmokers$hlthcoded)-mean(smokers$hlthcoded)
smokepermuted<-tibble(differences=perm_mean(perms=1000,all_values = tdata$hlthcoded,n_A = nrow(nonsmokers)))
ggplot(data=smokepermuted,aes(differences))+
geom_histogram(binwidth=.002,aes(fill=(differences<quantile(differences,probs = c(.025))[[1]]|differences>quantile(differences,probs = c(.975))[[1]])))+
labs(title="",fill="Tails")+
geom_vline(xintercept=smoke_calc_mean_diff)+labs()
percentile=nrow(filter(smokepermuted,differences<smoke_calc_mean_diff))/nrow(smokepermuted)
tibble(Percentile=percentile)
cdc_modified<-cdc%>%mutate(smoke100L=as.logical(smoke100))%>%mutate(hlthcoded=ifelse(genhlth=="excellent",5,
ifelse(genhlth=="very good",4,
ifelse(genhlth=="good",3,
ifelse(genhlth=="fair",2,
ifelse(genhlth=="poor",1,NA))))))
ggplot(data=cdc_modified,aes(genhlth,fill=smoke100L))+geom_bar(position="dodge")+labs(title="Smoking and General Health",fill="Has Smoked",x="General Health")
modelsmoke<-glm(smoke100~hlthcoded+age,family=binomial,data=tdata)
tdata<-add_predictions(tdata,modelsmoke)%>%mutate(psmoke=exp(pred)/(1+exp(pred)))
#tdata
smoking_probabilities<-cdc%>%group_by(genhlth)%>%summarise("Probability of Smoking"=mean(smoke100))%>%rename("General Health"=genhlth)
smoking_probabilities
age_smoking_prob<-cdc%>%group_by(age)%>%summarize(probability=mean(smoke100))
coef(modelsmoke)
ggplot(tdata,aes(age,psmoke,group=1))+geom_point(data=age_smoking_prob,aes(age,probability))+geom_smooth(aes(color=genhlth))+labs(y="Probability of Smoking",x="Age",title="Proability of Smoking and General Health")#+facet_wrap(~genhlth)
modelsmoke<-glm(smoke100~hlthcoded+age,family=binomial,data=tdata)
tdata<-add_predictions(tdata,modelsmoke)%>%mutate(psmoke=exp(pred)/(1+exp(pred)))
#tdata
smoking_probabilities<-cdc%>%group_by(genhlth)%>%summarise("Probability of Smoking"=mean(smoke100))%>%rename("General Health"=genhlth)
smoking_probabilities
age_smoking_prob<-cdc%>%group_by(age)%>%summarize(probability=mean(smoke100))
coef(modelsmoke)
ggplot(tdata,aes(age,psmoke,group=1))+geom_point(data=age_smoking_prob,aes(age,probability,color=genhlth))+geom_smooth(aes(color=genhlth))+labs(y="Probability of Smoking",x="Age",title="Proability of Smoking and General Health")#+facet_wrap(~genhlth)
modelsmoke<-glm(smoke100~hlthcoded+age,family=binomial,data=tdata)
tdata<-add_predictions(tdata,modelsmoke)%>%mutate(psmoke=exp(pred)/(1+exp(pred)))
#tdata
smoking_probabilities<-cdc%>%group_by(genhlth)%>%summarise("Probability of Smoking"=mean(smoke100))%>%rename("General Health"=genhlth)
smoking_probabilities
age_smoking_prob<-cdc%>%group_by(age)%>%summarize(probability=mean(smoke100))
coef(modelsmoke)
ggplot(tdata,aes(age,psmoke,group=1))+geom_point(data=age_smoking_prob,aes(age,probability))+geom_smooth(aes(color=genhlth))+geom_line()+labs(y="Probability of Smoking",x="Age",title="Proability of Smoking and General Health")#+facet_wrap(~genhlth)
modelsmoke<-glm(smoke100~hlthcoded+age,family=binomial,data=tdata)
tdata<-add_predictions(tdata,modelsmoke)%>%mutate(psmoke=exp(pred)/(1+exp(pred)))
#tdata
smoking_probabilities<-cdc%>%group_by(genhlth)%>%summarise("Probability of Smoking"=mean(smoke100))%>%rename("General Health"=genhlth)
smoking_probabilities
age_smoking_prob<-cdc%>%group_by(age)%>%summarize(probability=mean(smoke100))
coef(modelsmoke)
ggplot(tdata,aes(age,psmoke,group=1))+geom_point(data=age_smoking_prob,aes(age,probability))+geom_smooth(aes(color=genhlth))+geom_line()+labs(y="Probability of Smoking",x="Age",title="Proability of Smoking and General Health")+facet_wrap(~genhlth)
modelsmoke<-glm(smoke100~hlthcoded+age,family=binomial,data=tdata)
tdata<-add_predictions(tdata,modelsmoke)%>%mutate(psmoke=exp(pred)/(1+exp(pred)))
#tdata
smoking_probabilities<-cdc%>%group_by(genhlth)%>%summarise("Probability of Smoking"=mean(smoke100))%>%rename("General Health"=genhlth)
smoking_probabilities
age_smoking_prob<-cdc%>%group_by(genhlth,age)%>%summarize(probability=mean(smoke100))
coef(modelsmoke)
ggplot(tdata,aes(age,psmoke,group=1))+geom_point(data=age_smoking_prob,aes(age,probability,color=genhlth))+geom_smooth(aes(color=genhlth))+geom_line()+labs(y="Probability of Smoking",x="Age",title="Proability of Smoking and General Health")+facet_wrap(~genhlth)
modelsmoke<-glm(smoke100~hlthcoded+age,family=binomial,data=tdata)
tdata<-add_predictions(tdata,modelsmoke)%>%mutate(psmoke=exp(pred)/(1+exp(pred)))
#tdata
smoking_probabilities<-cdc%>%group_by(genhlth)%>%summarise("Probability of Smoking"=mean(smoke100))%>%rename("General Health"=genhlth)
smoking_probabilities
age_smoking_prob<-cdc%>%group_by(genhlth,age)%>%summarize(probability=mean(smoke100))
coef(modelsmoke)
ggplot(tdata,aes(age,psmoke,group=1))+geom_point(data=age_smoking_prob,aes(age,probability,color=genhlth))+geom_smooth(aes(color=genhlth))+geom_line()+labs(y="Probability of Smoking",x="Age",title="Proability of Smoking and General Health")#+facet_wrap(~genhlth)
modelsmoke<-glm(smoke100~hlthcoded+age,family=binomial,data=tdata)
tdata<-add_predictions(tdata,modelsmoke)%>%mutate(psmoke=exp(pred)/(1+exp(pred)))
#tdata
smoking_probabilities<-cdc%>%group_by(genhlth)%>%summarise("Probability of Smoking"=mean(smoke100))%>%rename("General Health"=genhlth)
smoking_probabilities
age_smoking_prob<-cdc%>%group_by(genhlth,age)%>%summarize(probability=mean(smoke100))
coef(modelsmoke)
ggplot(tdata,aes(age,psmoke,group=1))+geom_point(data=age_smoking_prob,aes(age,probability,color=genhlth))+geom_smooth(aes(color=genhlth))+labs(y="Probability of Smoking",x="Age",title="Proability of Smoking and General Health")#+facet_wrap(~genhlth)
modelsmoke<-glm(smoke100~hlthcoded+age,family=binomial,data=tdata)
tdata<-add_predictions(tdata,modelsmoke)%>%mutate(psmoke=exp(pred)/(1+exp(pred)))
#tdata
smoking_probabilities<-cdc%>%group_by(genhlth)%>%summarise("Probability of Smoking"=mean(smoke100))%>%rename("General Health"=genhlth)
smoking_probabilities
age_smoking_prob<-cdc%>%group_by(genhlth,age)%>%summarize(probability=mean(smoke100))
coef(modelsmoke)
ggplot(tdata,aes(age,psmoke))+geom_point(data=age_smoking_prob,aes(age,probability,color=genhlth))+geom_smooth(aes(color=genhlth))+labs(y="Probability of Smoking",x="Age",title="Proability of Smoking and General Health")#+facet_wrap(~genhlth)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(purrr)
library(broom)
library(stringr)
library(modelr)
source("http://www.openintro.org/stat/data/cdc.R")
cdc <- as_tibble(cdc)
perm_mean <- function(perms = 1000, all_values, n_A)
{
## Variables ##
# perms: The number of permutations
# all_values (num): all data values
# n_A (int): Size of group A
###############
# Step 1:
# Create vector of zeroes of length "perms" to store
# permuted mean differnces
permuted_mean_differences<-rep(0,perms)
# Loop throught number of permutations
for (i in c(1:perms))
{
# Step 2:
# Randomly separate vector "values" into disjoint
# groups of size "nA" and "nB" respectively
temp<-sample(all_values)
group_A<-temp[1:n_A]
group_B<-temp[(n_A+1):length(temp)]
# Step 3:
# Compute the sample means for the two groups from
# step 2
mean_A<-mean(group_A,na.rm=T)
mean_B<-mean(group_B,na.rm=T)
# Step 4:
# Compute the difference in sample means, store the
# value in the vector from step 1
permuted_mean_differences[i]<-mean_A-mean_B
}
# Step 5:
# Return the permuted mean differences vector
return(permuted_mean_differences)
}
perm_cor <- function(perms = 1000, x, y)
{
## Variables ##
# perms: The number of permutations
# x: Vector of Variable 1 - for computing correlation
# y: Vector of Variable 2 - for computing correlation
###############
# Step 1:
# Create vector of zeroes of length "perms" to store
# permuted mean differnces
correlations<-rep(0,perms)
# Loop throught number of permutations
for (i in c(1:perms))
{
# Step 2:
# Randomly mix up the values in the vector "y"
temp<-sample(y)
# Step 3:
# Compute the correlation between x and the randomly mixed
# up y-vector. Store this value in the vector from step 1.
correlations[i]<-cor(x,temp,use="pairwise.complete.obs")
}
# Step 4:
# Return new updated vector, created in step 1
return(correlations)
}
cdc
tdata<-cdc%>%mutate(hlthcoded=ifelse(genhlth=="excellent",5,
ifelse(genhlth=="very good",4,
ifelse(genhlth=="good",3,
ifelse(genhlth=="fair",2,
ifelse(genhlth=="poor",1,NA))))))
modelsmoke<-glm(smoke100~hlthcoded+age,family=binomial,data=tdata)
tdata<-add_predictions(tdata,modelsmoke)%>%mutate(psmoke=exp(pred)/(1+exp(pred)))
#tdata
smoking_probabilities<-cdc%>%group_by(genhlth)%>%summarise("Probability of Smoking"=mean(smoke100))%>%rename("General Health"=genhlth)
smoking_probabilities
age_smoking_prob<-cdc%>%group_by(genhlth,age)%>%summarize(probability=mean(smoke100))
coef(modelsmoke)
ggplot(tdata,aes(age,psmoke))+geom_point(data=age_smoking_prob,aes(age,probability,color=genhlth))+geom_smooth(aes(color=genhlth))+labs(y="Probability of Smoking",x="Age",title="Proability of Smoking and General Health")#+facet_wrap(~genhlth)
smokers<-tdata%>%filter(smoke100==1)
nonsmokers<-tdata%>%filter(smoke100==0)
smoke_calc_mean_diff<-mean(nonsmokers$hlthcoded)-mean(smokers$hlthcoded)
smokepermuted<-tibble(differences=perm_mean(perms=1000,all_values = tdata$hlthcoded,n_A = nrow(nonsmokers)))
ggplot(data=smokepermuted,aes(differences))+
geom_histogram(binwidth=.002,aes(fill=(differences<quantile(differences,probs = c(.025))[[1]]|differences>quantile(differences,probs = c(.975))[[1]])))+
labs(title="Permuted Mean differences Histogram",fill="Tails",x="Permuted mean Differences")+
geom_vline(xintercept=smoke_calc_mean_diff)+labs()
percentile=nrow(filter(smokepermuted,differences<smoke_calc_mean_diff))/nrow(smokepermuted)
tibble(Percentile=percentile)
cdc_modified<-cdc%>%mutate(smoke100L=as.logical(smoke100))%>%mutate(hlthcoded=ifelse(genhlth=="excellent",5,
ifelse(genhlth=="very good",4,
ifelse(genhlth=="good",3,
ifelse(genhlth=="fair",2,
ifelse(genhlth=="poor",1,NA))))))
ggplot(data=cdc_modified,aes(genhlth,fill=smoke100L))+geom_bar(position="dodge")+labs(title="Smoking and General Health",fill="Has Smoked",x="General Health")
bdata<-cdc%>%mutate(wtdiff=weight-wtdesire)%>%group_by(genhlth)%>%nest()
bmodel<-function(df){lm(formula = wtdesire~weight,data = df)}
bdata<-bdata%>%mutate("model"=map(bdata$data,bmodel))
bdata<-bdata%>%mutate(co=map(bdata$model,coef))
bdata<-bdata%>%mutate(predictions=map2(data,model,add_predictions))
bdata_predictions<-bdata%>%unnest(data,predictions,.drop=T)
bdata_predictions<-bdata_predictions%>%select(-(exerany1:gender1),-wtdiff1)
bdata<-bdata%>%mutate(slope=map_dbl(bdata$co,"weight"))
bdata_slopes<-bdata%>%select(genhlth,slope)
bdata_slopes
ggplot(bdata_predictions)+geom_point(aes(weight,wtdesire))+
facet_wrap(~genhlth)+
geom_smooth(aes(weight,pred,color=genhlth))
b2data<-cdc%>%mutate(wtdiff=weight-wtdesire)
good_health<-b2data%>%filter(genhlth %in% c("good","very good","excellent"))
poor_health<-b2data%>%filter(genhlth %in% c("fair", "poor"))
calculated_mean_diff<-mean(good_health$wtdiff)-mean(poor_health$wtdiff)
combined_vector<-c(good_health$wtdiff,poor_health$wtdiff)
permuted_mean_difference<-tibble(differences=perm_mean(perms=1000,all_values=combined_vector,n_A=nrow(good_health)))
ggplot(data=permuted_mean_difference,aes(differences))+
geom_histogram(binwidth=.1,aes(fill=(differences<quantile(differences,probs = c(.025))[[1]]|differences>quantile(differences,probs = c(.975))[[1]])))+
labs(title="Permuted Mean Differences",fill="Tails",x="Difference between the permuted means")+
geom_vline(xintercept=calculated_mean_diff)
percentile=nrow(filter(permuted_mean_difference,differences<calculated_mean_diff))/nrow(permuted_mean_difference)
tibble(Percentile=percentile)
bdata<-cdc%>%mutate(wtdiff=weight-wtdesire)%>%group_by(genhlth)%>%nest()
bmodel<-function(df){lm(formula = wtdesire~weight,data = df)}
bdata<-bdata%>%mutate("model"=map(bdata$data,bmodel))
bdata<-bdata%>%mutate(co=map(bdata$model,coef))
bdata<-bdata%>%mutate(predictions=map2(data,model,add_predictions))
bdata_predictions<-bdata%>%unnest(data,predictions,.drop=T)
bdata_predictions<-bdata_predictions%>%select(-(exerany1:gender1),-wtdiff1)
bdata<-bdata%>%mutate(slope=map_dbl(bdata$co,"weight"))
bdata_slopes<-bdata%>%select(genhlth,slope)
bdata_slopes
ggplot(bdata_predictions)+geom_point(aes(weight,wtdesire))+
facet_wrap(~genhlth)+
geom_smooth(aes(weight,pred,color=genhlth))+
labs(title="General Health and The Relationship between Weight and Desired Weight", y="Weight Desired",x="Weight",color="General Health")
b2data<-cdc%>%mutate(wtdiff=weight-wtdesire)
good_health<-b2data%>%filter(genhlth %in% c("good","very good","excellent"))
poor_health<-b2data%>%filter(genhlth %in% c("fair", "poor"))
calculated_mean_diff<-mean(good_health$wtdiff)-mean(poor_health$wtdiff)
combined_vector<-c(good_health$wtdiff,poor_health$wtdiff)
permuted_mean_difference<-tibble(differences=perm_mean(perms=1000,all_values=combined_vector,n_A=nrow(good_health)))
ggplot(data=permuted_mean_difference,aes(differences))+
geom_histogram(binwidth=.1,aes(fill=(differences<quantile(differences,probs = c(.025))[[1]]|differences>quantile(differences,probs = c(.975))[[1]])))+
labs(title="Permuted Mean Differences",fill="Tails",x="Difference between the permuted means")+
geom_vline(xintercept=calculated_mean_diff)
percentile=nrow(filter(permuted_mean_difference,differences<calculated_mean_diff))/nrow(permuted_mean_difference)
tibble(Percentile=percentile,"Numerical Result"=calculated_mean_diff)
