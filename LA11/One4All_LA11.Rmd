---
title: "One4All_LA11"
author: "Braden Griebel, Andrew Duffy, Ahyo Falick, Luke Fanning"
date: "11/8/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(stringr)
library(lubridate)
library(babynames)
bbnames18<-read_csv("yob2018.txt",col_names = F,col_types=cols(X2=col_character()))
bbnames18<-bbnames18%>%rename("name"=X1,"sex"=X2,"n"=X3)%>%mutate(year=2018)
```

# Braden Griebel Individual Section
## Selecting a Baby name
In 2017, the proportion of females included was 91.3% while the proportion of males was 93.44%, it was neccesary to make the assumption that these poportions are close to those for 2018 in order to calculate the proportions for 2018.

```{r}
tot_males<-bbnames18%>%filter(sex=="M")%>%summarize(total=sum(n))
tot_females<-bbnames18%>%filter(sex=="F")%>%summarize(total=sum(n))
tot_males<-tot_males[1,1]
tot_females<-tot_females[1,1]
prop<-babynames%>%filter(year==2017)%>%group_by(sex)%>%summarize(total=sum(prop))
prop_males<-prop[[2,2]]
prop_females<-prop[[1,2]]
tot_males<-tot_males/prop_males
tot_males<-tot_males[[1,1]]
tot_females<-tot_females/prop_females
tot_females<-tot_females[[1,1]]
bbnames18<-bbnames18%>%mutate("prop"=ifelse(sex=="M",n/tot_males,n/tot_females))
babynames<-full_join(babynames,bbnames18,by=c("name","prop","n","year","sex"))
bb<-babynames
```


First Step, eliminate names that are not obviously male or female. For this, names will be eliminated which have a proportion of males above .1% but below 99.9%. This will eliminate all names which are frequently used for both males and females. 

```{r}
#create filter for names that are not obviously male or female, and then eliminate those names from the original dataset
filter1<-bb%>%group_by(name)%>%summarize("number_males"=sum(ifelse(sex=="M",n,0)),total=sum(n))
filter1<-filter1%>%mutate(prop_males=number_males/total)
filter1<-filter1%>%filter(prop_males>=.001&prop_males<=.999)
bb<-anti_join(bb,filter1,by="name")
```

Next, eliminate all names which can easily be shortened

```{r}
bb<-bb%>%mutate(length=str_length(name))
start<-bb%>%select(name,length)
start2<-start%>%mutate("start"=str_sub(name,1,2))%>%filter(length>2)
start3<-start%>%mutate("start"=str_sub(name,1,3))%>%filter(length>3)
start4<-start%>%mutate("start"=str_sub(name,1,4))%>%filter(length>4)
start5<-start%>%mutate("start"=str_sub(name,1,5))%>%filter(length>5)


#Keep any names whose first n letters are somewhere in babynames
start2<-semi_join(start2,babynames,by=c("start"="name"))
start3<-semi_join(start3,babynames,by=c("start"="name"))
start4<-semi_join(start4,babynames,by=c("start"="name"))
start5<-semi_join(start5,babynames,by=c("start"="name"))





bb<-anti_join(bb,start2,by="name")
bb<-anti_join(bb,start3,by="name")
bb<-anti_join(bb,start4,by="name")
bb<-anti_join(bb,start5,by="name")
```







Trendy but not trending: We will define thise as having a positive slope on their linear model for the last 10 years (greater than 0.000009 so that it is likely that it wasn't just chance causing them to increase), so they are on the upswing, and eliminate the top 20 names to get rid of trendy names. 

```{r}
#get the slopes of all the names in these last 5 years
filter2<-bb%>%filter(year>2018-10)
counter=1
filter3<-tibble(name=c(""),slope=c(1))
for(i in unique(filter2$name)){
  temp1<-filter2%>%filter(name==i)
  slope=coefficients(lm(prop~year,data=temp1))[[2]]
  filter3[counter,1]=i
  filter3[counter,2]=slope
  counter=counter+1
}
```

```{r}
#eliminte names with small or negative slopes
check<-filter3%>%filter(slope>0.000009)
bb_final<-semi_join(bb,check,by="name")
y18<-bb_final%>%filter(year==2018)
```
```{r}
y18<-y18%>%mutate(rank=rank(desc(prop)))%>%arrange(rank)%>%filter(rank<20)
bb_final<-bb_final%>%anti_join(y18,by="name")
bb_final
```

```{r}
bb_final<-bb_final%>%mutate(coded=ifelse(sex=="M",1,0))%>%group_by(name)%>%summarize(gender=mean(coded))%>%
  mutate(gender=ifelse(gender>.5,"M","F"))
```




```{r}
bb_final%>%filter(gender=="M")
bb_final%>%filter(gender=="F")
```

Any of the above names meet the clients criteria, however, if I had to pick a name it would be Gannon for a male, and Scarlette for a female.  




## Individual plots of your nameâ€™s popularity over time

Regular Expression matching my name "Br[ae][yei]?d[aeyi]+n"

```{r}
first3<-babynames%>%filter(str_detect(name,"Bra"))%>%group_by(year)%>%summarize(prop=sum(prop))
braden_names<-babynames%>%filter(str_detect(name,"Br[ae][yei]?d[aeyi]+n"))%>%group_by(year)%>%summarize(prop=sum(prop))
ggplot(data=first3)+geom_smooth(aes(x=year,y=prop,color="Names that Start with Bra"),se=F)+
  geom_smooth(data=braden_names,aes(year,prop,color="Braden Names"),se=F)+labs(title="Popuarity of Braden Over time",
                                                                               x="Year",y="Proportion of Names")

```

**The regular expression matching my name is "Br[ae][yei]?d[aeyi]+n". My name has increased in popularity since my birth. My name is less popular than all other names starting with Bra combined, but it is increaseing in popularity while Bra names are decreasing in popularity.**



## Ariel and Rachel regexs


The first Table Below shows the number of versions of Ariel or Rachel in all the years listed, the second shows the probability of a girl named after Ariel, Rachel and Both


```{r}
ariel_regex<-"^A[y]?r+[iaey]+[aeiy]+l+[e]?$"
rachael_regex<-"^R[yae]+ch[ae]+l+e?$"
ar<-babynames%>%filter(sex=="F")%>%filter(year%in%c(1973,1988,1990,2018))
a_orr<-ar%>%group_by(year)%>%summarize(Female=sum(n*(sex=="F")),
                                       Ariel=sum(n*str_detect(name,ariel_regex)),
                                       Rachel=sum(n*str_detect(name,rachael_regex)))
a_orrversions<-ar%>%group_by(year)%>%summarize(Ariel_Versions=sum(str_detect(name,ariel_regex)),
                                       Rachel_Versions=sum(str_detect(name,rachael_regex)))
a_orrversions
a_orrprob<-a_orr%>%mutate(Probability_Ariel=Ariel/Female,
  Probability_Rachel=Rachel/Female,
  Probability_Ariel_Rachel=(Ariel+Rachel)/Female)%>%select(year,Probability_Ariel,Probability_Ariel_Rachel,Probability_Rachel)
a_orrprob
```


## The Little Mermaid Effect

The first number below represents the percentile of the Change in proportion of the name "Ariel" out of female names starting with a vowel, the second is for the Ariel regex constructed earlier. Since the regex catches so many simmilar names, it is obviously going to be higher than most of the other names. But even just counting Ariel the percentile is still very high. Thus Ariel has clearly increased significantly in proportion following the release of the Little Mermaid
```{r}
vowel_f<-babynames%>%filter(sex=="F",str_detect(name,"^[AEIOU]"),year%in%c(1988,1990))
vowel_f<-vowel_f%>%spread(key=year,value=prop)%>%group_by(name)%>%summarize(`1988`=mean(`1988`,na.rm=T),`1990`=mean(`1990`,na.rm=T))
vowel_f<-na.omit(vowel_f)
vowel_f<-vowel_f%>%mutate(change=`1990`-`1988`)
vowel_f<-vowel_f%>%select(name,change)
ariel_names<-babynames%>%filter(str_detect(name,"^Ariel$"),year%in%c(1988,1990),sex=="F")%>%group_by(year)%>%summarize(prop=sum(prop))
ariel_name_change<-ariel_names[[2,2]]-ariel_names[[1,2]]
less_ariel<-vowel_f%>%filter(change<ariel_name_change)
ariel_percentile<-100*(nrow(less_ariel)/nrow(vowel_f))
ariel_percentile
ariel_names<-babynames%>%filter(str_detect(name,ariel_regex),year%in%c(1988,1990),sex=="F")%>%group_by(year)%>%summarize(prop=sum(prop))
ariel_name_change<-ariel_names[[2,2]]-ariel_names[[1,2]]
less_ariel<-vowel_f%>%filter(change<ariel_name_change)
ariel_percentile<-100*(nrow(less_ariel)/nrow(vowel_f))
ariel_percentile
```
Plots for Change in Female name Proportions between 1988 and 1990 
```{r}
female_names<-babynames%>%filter(sex=="F")
female_names<-female_names%>%spread(key=year,value=prop)%>%group_by(name)%>%summarize(`1988`=mean(`1988`,na.rm=T),`1990`=mean(`1990`,na.rm=T))
female_names<-na.omit(female_names)
female_names<-female_names%>%mutate(change=`1990`-`1988`)
female_names<-female_names%>%select(name,change)
female_ariel_name_change_regex<-female_names%>%filter(str_detect(name,ariel_regex))
archange_regex<-sum(female_ariel_name_change_regex$change)
female_ariel_name_change<-female_names%>%filter(str_detect(name,"^Ariel$"))
archange<-sum(female_ariel_name_change$change)



ggplot(female_names,aes(change))+geom_histogram(bins=1000)+geom_vline(xintercept=archange_regex,color="blue")+geom_vline(xintercept=archange,color="red")+xlim(-0.0001,0.002)+
  labs(title="Distribution of Change in Proportion for female names",x="Change in Proportion",caption="Blue line represents change in proportion for the Ariel regex, red represents the change for Ariel only")
```


**Observations:** As can be seen in the graph above, both the change for just Ariel and for all names caught by the Ariel regex, are far to the right of the rest of the changes in proportion for female names between 1988 and 1990. The change in proportion of Ariels is therefor very large in comparison to other female names over that time period. Most of the changes in proportion are right around zero, decreasing in frequency as the change moves away from zero. 

## Your names

Below is displayed the changes, both relative and absolute, for all of my teams names between 1968 and 1998, as well as between 1998 and 2018. 

```{r}
x=2018-1998

braden_regex<-"^Br[ae][yei]?d[aeyi]+n$"
ahyo_regex<-"^A[yh]+[oa]$"
luke_regex<-"Luo?[ck]+e*$"
andrew_regex<-"Andr[ewu]+$"
name_change<-babynames%>%filter(year%in%c(1988-x,1998,2018),sex=="M")%>%spread(key=year,value=prop)%>%group_by(name)%>%summarize(`1968`=mean(`1968`,na.rm=T),`1998`=mean(`1998`,na.rm=T),`2018`=mean(`2018`,na.rm=T))%>%
  mutate(change1=`1998`-`1968`,change2=`2018`-`1998`)%>%select(name,change1,change2)




braden_change<-name_change%>%filter(str_detect(name,braden_regex))
braden_change1<-sum(braden_change$change1,na.rm=T)
braden_change2<-sum(braden_change$change2,na.rm=T)
braden_percentile1989<-name_change%>%filter(change1<braden_change1)
braden_percentile1989<-nrow(braden_percentile1989)/nrow(name_change)
braden_percentile2018<-name_change%>%filter(change2<braden_change2)
braden_percentile2018<-nrow(braden_percentile2018)/nrow(name_change)



ahyo_change<-name_change%>%filter(str_detect(name,ahyo_regex))
ahyo_change1<-sum(ahyo_change$change1,na.rm=T)
ahyo_change2<-sum(ahyo_change$change2,na.rm=T)
ahyo_percentile1989<-name_change%>%filter(change1<ahyo_change1)
ahyo_percentile1989<-nrow(ahyo_percentile1989)/nrow(name_change)
ahyo_percentile2018<-name_change%>%filter(change2<ahyo_change2)
ahyo_percentile2018<-nrow(ahyo_percentile2018)/nrow(name_change)




andrew_change<-name_change%>%filter(str_detect(name,andrew_regex))
andrew_change1<-sum(andrew_change$change1,na.rm=T)
andrew_change2<-sum(andrew_change$change2,na.rm=T)
andrew_percentile1989<-name_change%>%filter(change1<andrew_change1)
andrew_percentile1989<-nrow(andrew_percentile1989)/nrow(name_change)
andrew_percentile2018<-name_change%>%filter(change2<andrew_change2)
andrew_percentile2018<-nrow(andrew_percentile2018)/nrow(name_change)


luke_change<-name_change%>%filter(str_detect(name,luke_regex))
luke_change1<-sum(luke_change$change1,na.rm=T)
luke_change2<-sum(luke_change$change2,na.rm=T)
luke_percentile1989<-name_change%>%filter(change1<luke_change1)
luke_percentile1989<-nrow(luke_percentile1989)/nrow(name_change)
luke_percentile2018<-name_change%>%filter(change2<luke_change2)
luke_percentile2018<-nrow(luke_percentile2018)/nrow(name_change)



percentiles<-tibble("names"=c("Braden","Ahyo","Andrew","Luke"),"Percentile of Change From 1968 to 1998"=c(braden_percentile1989,ahyo_percentile1989,andrew_percentile1989,luke_percentile1989),
                    "Percentile of Change From 1998 to 2018"=c(braden_percentile2018,ahyo_percentile2018,andrew_percentile2018,luke_percentile2018),
                    "Absolute change from 1968 to 1998"=c(braden_change1,ahyo_change1,andrew_change1,luke_change1),
                    "Absolute change from 1998 to 2018"=c(braden_change2,ahyo_change2,andrew_change2,luke_change2))
percentiles


ggplot(name_change,aes(change1))+geom_histogram(aes(fill=(change1<=-0.002|change1>=.0017)),bins=100)+geom_vline(xintercept=percentiles[[1,4]],color="red")+geom_vline(xintercept=percentiles[[2,4]],color="blue")+
  geom_vline(xintercept=percentiles[[3,4]],color="purple")+geom_vline(xintercept=percentiles[[4,4]],color="green")+
  labs(title="Changes in name Proportion from 1968 to 1998",x="Change in Proportion of Male Names",caption="Braden is Red, Ahyo is Blue, Luke is Green, Andrew is Purple",fill="Tail")+
  coord_cartesian(xlim=c(-0.01,0.01),ylim=c(0,300))

ggplot(name_change,aes(change2))+geom_histogram(bins=100,aes(fill=(change2<=-.00105|change2>=.00095)))+
  geom_vline(xintercept=percentiles[[1,5]],color="red")+geom_vline(xintercept=percentiles[[2,5]],color="blue")+
  geom_vline(xintercept=percentiles[[3,5]],color="purple")+geom_vline(xintercept=percentiles[[4,5]],color="green")+
  labs(title="Changes in name Proportion from 1998 to 2018",x="Change in Proportion of Male Names",caption="Braden is Red, Ahyo is Blue, Luke is Green, Andrew is Purple",fill="Tail")+
    coord_cartesian(xlim=c(-0.009,0.005),ylim=c(0,300))




```


To deal with gender we filtered and only looked at male names, to deal with differences in birth year we had each person just use their birth year to do the calculations. From the graphs above it can be seen that for the change from 1968 to 1998, Andrew and Luke had significant changes in their proportion. In the change from 1998 to 2018 Braden, Luke, and Andrew had significant changes in their proportions. 


# Team Section
```{r}
selected_male<-"Gannon"
selected_female<-"Scarlette"
```

We have selected 
```{r echo=F}
selected_male
``` 


as the male name and 

```{r echo=F}
selected_female
```

as the female name  


These are obviously male or female as shown below, with negligible amount of the other sex named the same  
```{r}
smale<-babynames%>%filter(str_detect(name,selected_male))
sfemale<-babynames%>%filter(str_detect(name,selected_female))
ggplot(smale,aes(sex))+geom_bar()+labs(title="Sex for Selected Male Name")
ggplot(sfemale,aes(sex))+geom_bar()+labs(title="Sex for Selected Female Name")
```


  
  They are both trending  
```{r}
ggplot(smale,aes(year,prop))+geom_point()+labs(title="Proportion of Males named Selected Male Name")
ggplot(sfemale,aes(year,prop))+geom_point()+labs(title="Proportion of Females named Selected Female Name")

```
                                        
  
  
  
  
  But Neither are in the top 20 Male or Female Names for 2018  
```{r}
babynames%>%filter(year==2018,sex=="M")%>%filter(rank(desc(prop))<20)%>%arrange(desc(prop))
babynames%>%filter(year==2018,sex=="F")%>%filter(rank(desc(prop))<20)%>%arrange(desc(prop))
```


  
  
So these names meet all of the clients criteria, and sound cool and look nice as well. That is why we picked 
```{r echo=F}
selected_male
```

and 

```{r echo=F}
selected_female
```

###Andrew Duffy Individual Section
```{r, warning = FALSE, message = FALSE, echo = FALSE}
babies <- bbnames18
And <- babies %>% filter(str_detect(babies$name, "^[Aa]nd"))

andrew <- babies %>% filter(str_detect(babies$name, "^Andrew$"))
Andrew <- Andrew %>% aggregate(Andrew$prop, by=list(Andrew$year), FUN = median)

ggplot(data = Andrew, aes(x = year, y = prop)) + geom_smooth(se = FALSE) + geom_smooth(data = And, aes(x = year, y = prop), se = FALSE, color = 'darkblue')

popularity <- Andrew %>% filter(year >= 1979)
ggplot(data = popularity) + geom_smooth(aes(x = year, y = prop), se = FALSE) + ggtitle("Popularity of the name Andrew since 1999") + labs(x = "Year", y = "Proportion")

```


```{r, warning = FALSE, message = FALSE}
regex1973 <- babynames %>% filter(year == 1973)
ariel1973 <- regex1973 %>% mutate(contains = str_detect(regex1973$name,"Ari[ae]")) %>% filter(contains == TRUE & sex == "F") 
rachel1973 <- regex1973 %>% mutate(contains = str_detect(regex1973$name, "Rach[ae]")) %>% filter(contains == TRUE & sex =="F")
joined1973 <- rbind(rachel1973, ariel1973)

rachelandariel1973 = sum(joined1973$n)
total1973 = sum(regex1973$n)
prob1973 = rachelandariel1973 / total1973


regex1988 <- babynames %>% filter(year == 1988)
ariel1988 <- regex1988 %>% mutate(contains = str_detect(regex1988$name,"Ari[ae]")) %>% filter(contains == TRUE & sex == "F")
rachel1988 <- regex1988 %>% mutate(contains = str_detect(regex1988$name, "Rach[ae]")) %>% filter(contains == TRUE & sex == "F")
joined1988 <- rbind(rachel1988, ariel1988)

rachelandariel1988 <- sum(joined1988$n)
total1988 <- sum(regex1988$n)
prob1988 <- rachelandariel1988 / total1988


regex1990 <- babynames %>% filter(year == 1990)
ariel1990 <- regex1990 %>% mutate(contains = str_detect(regex1990$name,"Ari[ae]")) %>% filter(contains == TRUE & sex == "F")
rachel1990 <- regex1990 %>% mutate(contains = str_detect(regex1990$name, "Rach[ae]")) %>% filter(contains == TRUE & sex == "F")
joined1990 <- rbind(rachel1990, ariel1990)

rachelandariel1990 <- sum(joined1990$n)
total1990 <- sum(regex1990$n)
prob1990 <- rachelandariel1990 / total1990
```

```{r, warning = FALSE, message = FALSE}
regex1989 <- babynames %>% filter(year == 1989)

ariel1989 <- regex1989 %>% mutate(contains = str_detect(name, "Ari[ae]")) %>% filter (contains == TRUE & sex == "F") 

percenta <- ((sum(ariel1989$n) / sum(ariel1988$n)) * 100) - 100


caroline1988  <- regex1988 %>% mutate(contains = str_detect(name, "Carol[iy]")) %>% filter(contains == TRUE & sex == "F") 
caroline1989  <- regex1989 %>% mutate(contains = str_detect(name, "Carol[iy]")) %>% filter(contains == TRUE & sex == "F") 

percentc <- ((sum(caroline1989$n) / sum(caroline1988$n)) * 100) - 100

isabella1988  <- regex1988 %>% mutate(contains = str_detect(name, "Isabel[la.]")) %>% filter (contains == TRUE & sex == "F") 
isabella1989  <- regex1989 %>% mutate(contains = str_detect(name, "Isabel[la.]")) %>% filter (contains == TRUE & sex == "F") 

percenti <- ((sum(isabella1988$n) / sum(isabella1989$n)) * 100) - 100

megan1988  <- regex1988 %>% mutate(contains = str_detect(name, "Meg[ha]")) %>% filter (contains == TRUE & sex == "F") 
megan1989  <- regex1989 %>% mutate(contains = str_detect(name, "Meg[ha]")) %>% filter (contains == TRUE & sex == "F")  

percentm <- ((sum(megan1988$n) / sum(megan1989$n)) * 100) - 100



list = c("Ariel", "Caroline", "Isabella", "Megan")
plist = c(percenta, percentc, percenti, percentm)
xdata <- as.tibble(list)

ggplot(data = xdata, aes(x = list, y = plist)) + geom_bar(stat = "identity", color = 'blue', fill = 'lightblue') + labs(x = "Names", y = "Percent Increase from 1988 to 1989") + ggtitle("The Little Mermaid Effect")


```


## Individual Contributions:

I, Braden Griebel, started by filtering the babynames according to the clients criteria. I did this by creating a filtering dataset, either positive or negative, and then using a semi or anti join respectively to filter down the initial dataset to meet the clients specifications. I created the negative filter for the male female criteria, by filtering out all names that had a very high or low proportion of males, and then getting rid of all these names in the initial dataset. For the trending but not trendy I examined the slope of a linear model for the last 10 years and made sure it was non-negative (or small positive to make sure the trend was actually clear). For the shortening criteria, I took the first 2,3,4, and 5 letters of all the names, and filtered all the ones that had a match in the dataset and made that a negative filter to match with the dataset, since all of the names could be shortened. Next I used a regex to catch common spellings of my name and plotted the popularity over time, and then moved on the the ariel section. I created regex's for ariel and rachel to catch common spellings, and then used these to find the proportions of names that matched and calculated the number of variations on the names and the probability a baby was named rachel, ariel, and the combined probability of the two. Next I examined how Ariel's popularity had been affected by the little mermaid and found that both Ariel and its common spellings had increased significantly compared to other female names starting with a vowel (using percentiles) and also to all other female names using a histogram. In all cases I found that the proportion of both Ariel and all its common spellings had increased significantly between 1988 and 1990. Next I used regexs to match my, and my teammates names and find how they had changed between 1968 (20 years before my birth) to 1998 (my birth year) to 2018 (the last year we had data for). I showed this change on a histogram, coloring the tails, and using lines to represent where all out team names fell in the data. I also calculated percentiles in addition to absolute change for our team names, and determined which had significant changes in proportion in the two time periods. Finally, I added graphs to the team section showing how the names we selected met the clients criteria (by showing the proportion of sexes for the names, their proportions over the years but that they weren't trendy in 2018). It is clear from the names themselves that their shortenings do not appear in the data set, so it wan't neccesary to include that part as part of the team section. 















































