df<-tibble("name"=names(correlation_coefficient),"cor"=correlation_coefficient)
df<-left_join(df,select(co2_emissions,country,continent),by="country")
models <- co2_data %>%
split(.$country) %>%
map(~lm(co2_emissions_tonnes_per_person ~ year, data = .))
#models
correlation_coefficient<-models %>%
map(summary) %>%
map_dbl(~.$r.squared)
continents<-co2_data%>%select(country,continent)
df<-tibble("name"=names(correlation_coefficient),"cor"=correlation_coefficient)
df<-left_join(df,continents,by="country")
models <- co2_data %>%
split(.$country) %>%
map(~lm(co2_emissions_tonnes_per_person ~ year, data = .))
#models
correlation_coefficient<-models %>%
map(summary) %>%
map_dbl(~.$r.squared)
continents<-co2_data%>%select(country,continent)
df<-tibble("country"=names(correlation_coefficient),"cor"=correlation_coefficient)
df<-left_join(df,continents,by="country")
df
models <- co2_data %>%
split(.$country) %>%
map(~lm(co2_emissions_tonnes_per_person ~ year, data = .))
#models
correlation_coefficient<-models %>%
map(summary) %>%
map_dbl(~.$r.squared)
continents<-co2_data%>%select(country,continent)
df<-tibble("country"=names(correlation_coefficient),"cor"=correlation_coefficient)
df<-left_join(df,continents,by="country")
europe_correlations<-df%>%filter(continent=="europe")
americas_correlations<-df%>%filter(continent=="americas")
actual_mean_difference<-mean(americas_correlations$cor)-mean(europe_correlations)
actual_mean_difference
AE_correlations<-df%>%filter(continent=="americas"|continent=="europe")
permuted_means<-tibble("correlation"=perm_mean(perms=1000,all_values = AE_correlations$cor, n_A = nrow(americas_correlations)))
ggplot(permuted_means,aes(correlations,,fill=(correlation<quantile(correlation,probs = c(.025),na.rm=T)[[1]]|correlation>quantile(correlation,probs = c(.975),na.rm=T)[[1]])))+
geom_histogram()
models <- co2_data %>%
split(.$country) %>%
map(~lm(co2_emissions_tonnes_per_person ~ year, data = .))
#models
correlation_coefficient<-models %>%
map(summary) %>%
map_dbl(~.$r.squared)
continents<-co2_data%>%select(country,continent)
df<-tibble("country"=names(correlation_coefficient),"cor"=correlation_coefficient)
df<-left_join(df,continents,by="country")
europe_correlations<-df%>%filter(continent=="europe")
americas_correlations<-df%>%filter(continent=="americas")
actual_mean_difference<-mean(americas_correlations$cor)-mean(europe_correlations)
actual_mean_difference
AE_correlations<-df%>%filter(continent=="americas"|continent=="europe")
permuted_means<-tibble("correlation"=perm_mean(perms=1000,all_values = AE_correlations$cor, n_A = nrow(americas_correlations)))
ggplot(permuted_means,aes(correlation,fill=(correlation<quantile(correlation,probs = c(.025),na.rm=T)[[1]]|correlation>quantile(correlation,probs = c(.975),na.rm=T)[[1]])))+
geom_histogram()
models <- co2_data %>%
split(.$country) %>%
map(~lm(co2_emissions_tonnes_per_person ~ year, data = .))
#models
correlation_coefficient<-models %>%
map(summary) %>%
map_dbl(~.$r.squared)
continents<-co2_data%>%select(country,continent)
df<-tibble("country"=names(correlation_coefficient),"cor"=correlation_coefficient)
df<-left_join(df,continents,by="country")
europe_correlations<-df%>%filter(continent=="europe")
americas_correlations<-df%>%filter(continent=="americas")
actual_mean_difference<-mean(americas_correlations$cor,na.rm=T)-mean(europe_correlations,na.rm=T)
actual_mean_difference
AE_correlations<-df%>%filter(continent=="americas"|continent=="europe")
permuted_means<-tibble("correlation"=perm_mean(perms=1000,all_values = AE_correlations$cor, n_A = nrow(americas_correlations)))
ggplot(permuted_means,aes(correlation,fill=(correlation<quantile(correlation,probs = c(.025),na.rm=T)[[1]]|correlation>quantile(correlation,probs = c(.975),na.rm=T)[[1]])))+
geom_histogram()
models <- co2_data %>%
split(.$country) %>%
map(~lm(co2_emissions_tonnes_per_person ~ year, data = .))
#models
correlation_coefficient<-models %>%
map(summary) %>%
map_dbl(~.$r.squared)
continents<-co2_data%>%select(country,continent)
df<-tibble("country"=names(correlation_coefficient),"cor"=correlation_coefficient)
df<-left_join(df,continents,by="country")
europe_correlations<-df%>%filter(continent=="europe")
americas_correlations<-df%>%filter(continent=="americas")
actual_mean_difference<-mean(americas_correlations$cor,na.rm=T)-mean(europe_correlations,na.rm=T)
actual_mean_difference
AE_correlations<-df%>%filter(continent=="americas"|continent=="europe")
permuted_means<-tibble("correlation"=perm_mean(perms=1000,all_values = AE_correlations$cor, n_A = nrow(americas_correlations)))
ggplot(permuted_means,aes(correlation,fill=(correlation<quantile(correlation,probs = c(.025),na.rm=T)[[1]]|correlation>quantile(correlation,probs = c(.975),na.rm=T)[[1]])))+
geom_histogram()+
labs(fill="Tails")
models <- co2_data %>%
split(.$country) %>%
map(~lm(co2_emissions_tonnes_per_person ~ year, data = .))
#models
correlation_coefficient<-models %>%
map(summary) %>%
map_dbl(~.$r.squared)
continents<-co2_data%>%select(country,continent)
df<-tibble("country"=names(correlation_coefficient),"cor"=correlation_coefficient)
df<-left_join(df,continents,by="country")
europe_correlations<-df%>%filter(continent=="europe")
americas_correlations<-df%>%filter(continent=="americas")
actual_mean_difference<-mean(americas_correlations$cor,na.rm=T)-mean(europe_correlations,na.rm=T)
actual_mean_difference
#AE_correlations<-df%>%filter(continent=="americas"|continent=="europe")
#permuted_means<-tibble("correlation"=perm_mean(perms=1000,all_values = AE_correlations$cor, n_A = nrow(americas_correlations)))
#ggplot(permuted_means,aes(correlation,fill=(correlation<quantile(correlation,probs = c(.025),na.rm=T)[[1]]|correlation>quantile(correlation,probs = c(.975),na.rm=T)[[1]])))+
#  geom_histogram()+
#  labs(fill="Tails")
models <- co2_data %>%
split(.$country) %>%
map(~lm(co2_emissions_tonnes_per_person ~ year, data = .))
#models
correlation_coefficient<-models %>%
map(summary) %>%
map_dbl(~.$r.squared)
continents<-co2_data%>%select(country,continent)
df<-tibble("country"=names(correlation_coefficient),"cor"=correlation_coefficient)
df<-left_join(df,continents,by="country")
europe_correlations<-df%>%filter(continent=="europe")
americas_correlations<-df%>%filter(continent=="americas")
actual_mean_difference<-mean(americas_correlations$cor,na.rm=T)-mean(europe_correlations$cor,na.rm=T)
actual_mean_difference
#AE_correlations<-df%>%filter(continent=="americas"|continent=="europe")
#permuted_means<-tibble("correlation"=perm_mean(perms=1000,all_values = AE_correlations$cor, n_A = nrow(americas_correlations)))
#ggplot(permuted_means,aes(correlation,fill=(correlation<quantile(correlation,probs = c(.025),na.rm=T)[[1]]|correlation>quantile(correlation,probs = c(.975),na.rm=T)[[1]])))+
#  geom_histogram()+
#  labs(fill="Tails")
models <- co2_data %>%
split(.$country) %>%
map(~lm(co2_emissions_tonnes_per_person ~ year, data = .))
#models
correlation_coefficient<-models %>%
map(summary) %>%
map_dbl(~.$r.squared)
continents<-co2_data%>%select(country,continent)
df<-tibble("country"=names(correlation_coefficient),"cor"=correlation_coefficient)
df<-left_join(df,continents,by="country")
europe_correlations<-df%>%filter(continent=="europe")
americas_correlations<-df%>%filter(continent=="americas")
actual_mean_difference<-mean(americas_correlations$cor,na.rm=T)-mean(europe_correlations$cor,na.rm=T)
AE_correlations<-df%>%filter(continent=="americas"|continent=="europe")
permuted_means<-tibble("correlation"=perm_mean(perms=1000,all_values = AE_correlations$cor, n_A = nrow(americas_correlations)))
ggplot(permuted_means,aes(correlation,fill=(correlation<quantile(correlation,probs = c(.025),na.rm=T)[[1]]|correlation>quantile(correlation,probs = c(.975),na.rm=T)[[1]])))+
geom_histogram()+
labs(fill="Tails")
models <- co2_data %>%
split(.$country) %>%
map(~lm(co2_emissions_tonnes_per_person ~ year, data = .))
#models
correlation_coefficient<-models %>%
map(summary) %>%
map_dbl(~.$r.squared)
continents<-co2_data%>%select(country,continent)
df<-tibble("country"=names(correlation_coefficient),"cor"=correlation_coefficient)
df<-left_join(df,continents,by="country")
europe_correlations<-df%>%filter(continent=="europe")
americas_correlations<-df%>%filter(continent=="americas")
actual_mean_difference<-mean(americas_correlations$cor,na.rm=T)-mean(europe_correlations$cor,na.rm=T)
AE_correlations<-df%>%filter(continent=="americas"|continent=="europe")
permuted_means<-tibble("correlation"=perm_mean(perms=1000,all_values = AE_correlations$cor, n_A = nrow(americas_correlations)))
ggplot(permuted_means,aes(correlation,fill=(correlation<quantile(correlation,probs = c(.025),na.rm=T)[[1]]|correlation>quantile(correlation,probs = c(.975),na.rm=T)[[1]])))+
geom_histogram()+
geom_vline(xintercept=actual_mean_difference,color="red")+
labs(fill="Tails")
models <- co2_data %>%
split(.$country) %>%
map(~lm(co2_emissions_tonnes_per_person ~ year, data = .))
#models
correlation_coefficient<-models %>%
map(summary) %>%
map_dbl(~.$r.squared)
continents<-co2_data%>%select(country,continent)
df<-tibble("country"=names(correlation_coefficient),"cor"=correlation_coefficient)
df<-left_join(df,continents,by="country")
europe_correlations<-df%>%filter(continent=="europe")
americas_correlations<-df%>%filter(continent=="americas")
actual_mean_difference<-mean(americas_correlations$cor,na.rm=T)-mean(europe_correlations$cor,na.rm=T)
AE_correlations<-df%>%filter(continent=="americas"|continent=="europe")
permuted_means<-tibble("correlation"=perm_mean(perms=1000,all_values = AE_correlations$cor, n_A = nrow(americas_correlations)))
ggplot(permuted_means,aes(correlation,fill=(correlation<quantile(correlation,probs = c(.025),na.rm=T)[[1]]|correlation>quantile(correlation,probs = c(.975),na.rm=T)[[1]])))+
geom_histogram(binwidth = .001)+
geom_vline(xintercept=actual_mean_difference,color="red")+
labs(fill="Tails")
models <- co2_data %>%
split(.$country) %>%
map(~lm(co2_emissions_tonnes_per_person ~ year, data = .))
#models
correlation_coefficient<-models %>%
map(summary) %>%
map_dbl(~.$r.squared)
continents<-co2_data%>%select(country,continent)
df<-tibble("country"=names(correlation_coefficient),"cor"=correlation_coefficient)
df<-left_join(df,continents,by="country")
europe_correlations<-df%>%filter(continent=="europe")
americas_correlations<-df%>%filter(continent=="americas")
actual_mean_difference<-mean(americas_correlations$cor,na.rm=T)-mean(europe_correlations$cor,na.rm=T)
AE_correlations<-df%>%filter(continent=="americas"|continent=="europe")
permuted_means<-tibble("correlation"=perm_mean(perms=1000,all_values = AE_correlations$cor, n_A = nrow(americas_correlations)))
ggplot(permuted_means,aes(correlation,fill=(correlation<quantile(correlation,probs = c(.025),na.rm=T)[[1]]|correlation>quantile(correlation,probs = c(.975),na.rm=T)[[1]])))+
geom_histogram(binwidth = .003)+
geom_vline(xintercept=actual_mean_difference,color="red")+
labs(fill="Tails")
models <- co2_data %>%
split(.$country) %>%
map(~lm(co2_emissions_tonnes_per_person ~ year, data = .))
#models
correlation_coefficient<-models %>%
map(summary) %>%
map_dbl(~.$r.squared)
continents<-co2_data%>%select(country,continent)
df<-tibble("country"=names(correlation_coefficient),"cor"=correlation_coefficient)
df<-left_join(df,continents,by="country")
europe_correlations<-df%>%filter(continent=="europe")
americas_correlations<-df%>%filter(continent=="americas")
actual_mean_difference<-mean(americas_correlations$cor,na.rm=T)-mean(europe_correlations$cor,na.rm=T)
AE_correlations<-df%>%filter(continent=="americas"|continent=="europe")
permuted_means<-tibble("correlation"=perm_mean(perms=1000,all_values = AE_correlations$cor, n_A = nrow(americas_correlations)))
ggplot(permuted_means,aes(correlation,fill=(correlation<quantile(correlation,probs = c(.025),na.rm=T)[[1]]|correlation>quantile(correlation,probs = c(.975),na.rm=T)[[1]])))+
geom_histogram(binwidth = .003)+
geom_vline(xintercept=actual_mean_difference,color="red")+
labs(fill="Tails")
per<-nrow(filter(permuted_means,correlation<actual_mean_difference))/nrow(permuted_means)
percentile<-tibble("Mean Difference"=actual_mean_difference,"Percentile"=per)
models <- co2_data %>%
split(.$country) %>%
map(~lm(co2_emissions_tonnes_per_person ~ year, data = .))
#models
correlation_coefficient<-models %>%
map(summary) %>%
map_dbl(~.$r.squared)
continents<-co2_data%>%select(country,continent)
df<-tibble("country"=names(correlation_coefficient),"cor"=correlation_coefficient)
df<-left_join(df,continents,by="country")
europe_correlations<-df%>%filter(continent=="europe")
americas_correlations<-df%>%filter(continent=="americas")
actual_mean_difference<-mean(americas_correlations$cor,na.rm=T)-mean(europe_correlations$cor,na.rm=T)
AE_correlations<-df%>%filter(continent=="americas"|continent=="europe")
permuted_means<-tibble("correlation"=perm_mean(perms=1000,all_values = AE_correlations$cor, n_A = nrow(americas_correlations)))
ggplot(permuted_means,aes(correlation,fill=(correlation<quantile(correlation,probs = c(.025),na.rm=T)[[1]]|correlation>quantile(correlation,probs = c(.975),na.rm=T)[[1]])))+
geom_histogram(binwidth = .003)+
geom_vline(xintercept=actual_mean_difference,color="red")+
labs(fill="Tails")
per<-nrow(filter(permuted_means,correlation<actual_mean_difference))/nrow(permuted_means)
percentile<-tibble("Mean Difference"=actual_mean_difference,"Percentile"=per)
percentile
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(stringr)
library(purrr)
library(readxl)
co2_per_person<-read_csv(file="co2_emissions_tonnes_per_person.csv")
co2_economic<-read_csv(file = "co2_intensity_of_economic_output_kg_co2_per_2011_ppp_of_gdp.csv")
co2_cummulative<-read_csv(file = "cumulative_co2_emissions_tonnes.csv")
co2_emissions<-read_csv(file = "yearly_co2_emissions_1000_tonnes.csv")
forest_coverage<-read_csv(file="forest_coverage_percent.csv")
regions<-read_excel(path="Data Geographies - v1 - by Gapminder.xlsx",sheet="list-of-countries-etc")
co2_per_person<-co2_per_person%>%select(country,`1990`:`2014`)
co2_economic<-co2_economic%>%select(country,`1990`:`2014`)
co2_cummulative<-co2_cummulative%>%select(country,`1990`:`2014`)
co2_emissions<-co2_emissions%>%select(country,`1990`:`2014`)
forest_coverage<-forest_coverage%>%select(country,`1990`:`2014`)
co2_per_person<-co2_per_person%>%gather(`1990`:`2014`,key="year",value="co2_emissions_tonnes_per_person")
co2_economic<-co2_economic%>%gather(`1990`:`2014`,key="year",value="co2_intensity_of_economic_output_kg_co2_per_2011_ppp_of_gdp")
co2_cummulative<-co2_cummulative%>%gather(`1990`:`2014`,key="year",value="cumulative_co2_emissions_tonnes")
co2_emissions<-co2_emissions%>%gather(`1990`:`2014`,key="year",value="yearly_co2_emissions_1000_tonnes")
forest_coverage<-forest_coverage%>%gather(`1990`:`2014`,key="year",value="forest_coverage_percent")
data<-list(co2_per_person,co2_economic,co2_cummulative,co2_emissions,forest_coverage)
co2_data<-data%>%reduce(full_join)
regions<-regions%>%select(name,four_regions,eight_regions,`World bank region`)%>%rename("country"=name,"continent"=four_regions,"continent_spec"= eight_regions,"wbr"=`World bank region`)
co2_data<-co2_data%>%left_join(regions, by="country")
perm_mean <- function(perms = 1000, all_values, n_A)
{
## Variables ##
# perms: The number of permutations
# all_values (num): all data values
# n_A (int): Size of group A
###############
# Step 1:
# Create vector of zeroes of length "perms" to store
# permuted mean differnces
permuted_mean_differences<-rep(0,perms)
# Loop throught number of permutations
for (i in c(1:perms))
{
# Step 2:
# Randomly separate vector "values" into disjoint
# groups of size "nA" and "nB" respectively
temp<-sample(all_values)
group_A<-temp[1:n_A]
group_B<-temp[(n_A+1):length(temp)]
# Step 3:
# Compute the sample means for the two groups from
# step 2
mean_A<-mean(group_A,na.rm=T)
mean_B<-mean(group_B,na.rm=T)
# Step 4:
# Compute the difference in sample means, store the
# value in the vector from step 1
permuted_mean_differences[i]<-mean_A-mean_B
}
# Step 5:
# Return the permuted mean differences vector
return(permuted_mean_differences)
}
perm_cor <- function(perms = 1000, x, y)
{
## Variables ##
# perms: The number of permutations
# x: Vector of Variable 1 - for computing correlation
# y: Vector of Variable 2 - for computing correlation
###############
# Step 1:
# Create vector of zeroes of length "perms" to store
# permuted mean differnces
correlations<-rep(0,perms)
# Loop throught number of permutations
for (i in c(1:perms))
{
# Step 2:
# Randomly mix up the values in the vector "y"
temp<-sample(y)
# Step 3:
# Compute the correlation between x and the randomly mixed
# up y-vector. Store this value in the vector from step 1.
correlations[i]<-cor(x,temp,use="pairwise.complete.obs")
}
# Step 4:
# Return new updated vector, created in step 1
return(correlations)
}
co2_data<-co2_data%>%mutate(year=as.double(year))
co2_data
models <- co2_data %>%
split(.$country) %>%
map(~lm(co2_emissions_tonnes_per_person ~ year, data = .))
#models
correlation_coefficient<-models %>%
map(summary) %>%
map_dbl(~.$r.squared)
continents<-co2_data%>%select(country,continent)
df<-tibble("country"=names(correlation_coefficient),"cor"=correlation_coefficient)
df<-left_join(df,continents,by="country")
europe_correlations<-df%>%filter(continent=="europe")
americas_correlations<-df%>%filter(continent=="americas")
actual_mean_difference<-mean(americas_correlations$cor,na.rm=T)-mean(europe_correlations$cor,na.rm=T)
AE_correlations<-df%>%filter(continent=="americas"|continent=="europe")
permuted_means<-tibble("correlation"=perm_mean(perms=1000,all_values = AE_correlations$cor, n_A = nrow(americas_correlations)))
ggplot(permuted_means,aes(correlation,fill=(correlation<quantile(correlation,probs = c(.025),na.rm=T)[[1]]|correlation>quantile(correlation,probs = c(.975),na.rm=T)[[1]])))+
geom_histogram(binwidth = .003)+
geom_vline(xintercept=actual_mean_difference,color="red")+
labs(fill="Tails")
per<-nrow(filter(permuted_means,correlation<actual_mean_difference))/nrow(permuted_means)
percentile<-tibble("Mean Difference"=actual_mean_difference,"Percentile"=per)
percentile
#The code below takes the co2 data and maps the mean median and sd functions to all the numeric columns in the co2 data set, it was used to explore the characteristics of each of the columns before further examination
#using a permutation test
summary_mean<-co2_data%>%select(co2_emissions_tonnes_per_person:forest_coverage_percent)%>%map(mean,na.rm=T)
summary_mean<-as_tibble(summary_mean)%>%mutate(statistic="mean")
summary_median<-co2_data%>%select(co2_emissions_tonnes_per_person:forest_coverage_percent)%>%map(median,na.rm=T)
summary_median<-as_tibble(summary_median)%>%mutate(statistic="median")
summary_sd<-co2_data%>%select(co2_emissions_tonnes_per_person:forest_coverage_percent)%>%map(sd,na.rm=T)
summary_sd<-as_tibble(summary_sd)%>%mutate(statistic="sd")
summar<-reduce(list(summary_mean,summary_median,summary_sd),full_join)
summar<-summar%>%select(statistic,co2_emissions_tonnes_per_person:forest_coverage_percent)
summar
actual_correlation<-cor(co2_data$forest_coverage_percent,co2_data$co2_intensity_of_economic_output_kg_co2_per_2011_ppp_of_gdp, use="pairwise.complete.obs")
correlations_generated<-tibble(correlation=perm_cor(perms=1000,co2_data$forest_coverage_percent,co2_data$co2_intensity_of_economic_output_kg_co2_per_2011_ppp_of_gdp))
ggplot(data=correlations_generated,aes(correlation,fill=(correlation<quantile(correlation,probs = c(.025),na.rm=T)[[1]]|correlation>quantile(correlation,probs = c(.975),na.rm=T)[[1]])))+
geom_histogram()+
geom_vline(xintercept = actual_correlation,color="red")+
labs(title="Correlation Permutation Test Between CO2 Economic Intensity and Forest Cover",fill="Tails")
percentile<-nrow(filter(correlations_generated,correlation<actual_correlation))/nrow(correlations_generated)
correlation_summary<-tibble("Correlation"=c(actual_correlation),"Percentile"=c(percentile))
correlation_summary
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(stringr)
library(purrr)
library(readxl)
co2_per_person<-read_csv(file="co2_emissions_tonnes_per_person.csv")
co2_economic<-read_csv(file = "co2_intensity_of_economic_output_kg_co2_per_2011_ppp_of_gdp.csv")
co2_cummulative<-read_csv(file = "cumulative_co2_emissions_tonnes.csv")
co2_emissions<-read_csv(file = "yearly_co2_emissions_1000_tonnes.csv")
forest_coverage<-read_csv(file="forest_coverage_percent.csv")
regions<-read_excel(path="Data Geographies - v1 - by Gapminder.xlsx",sheet="list-of-countries-etc")
co2_per_person<-co2_per_person%>%select(country,`1990`:`2014`)
co2_economic<-co2_economic%>%select(country,`1990`:`2014`)
co2_cummulative<-co2_cummulative%>%select(country,`1990`:`2014`)
co2_emissions<-co2_emissions%>%select(country,`1990`:`2014`)
forest_coverage<-forest_coverage%>%select(country,`1990`:`2014`)
co2_per_person<-co2_per_person%>%gather(`1990`:`2014`,key="year",value="co2_emissions_tonnes_per_person")
co2_economic<-co2_economic%>%gather(`1990`:`2014`,key="year",value="co2_intensity_of_economic_output_kg_co2_per_2011_ppp_of_gdp")
co2_cummulative<-co2_cummulative%>%gather(`1990`:`2014`,key="year",value="cumulative_co2_emissions_tonnes")
co2_emissions<-co2_emissions%>%gather(`1990`:`2014`,key="year",value="yearly_co2_emissions_1000_tonnes")
forest_coverage<-forest_coverage%>%gather(`1990`:`2014`,key="year",value="forest_coverage_percent")
data<-list(co2_per_person,co2_economic,co2_cummulative,co2_emissions,forest_coverage)
co2_data<-data%>%reduce(full_join)
regions<-regions%>%select(name,four_regions,eight_regions,`World bank region`)%>%rename("country"=name,"continent"=four_regions,"continent_spec"= eight_regions,"wbr"=`World bank region`)
co2_data<-co2_data%>%left_join(regions, by="country")
perm_mean <- function(perms = 1000, all_values, n_A)
{
## Variables ##
# perms: The number of permutations
# all_values (num): all data values
# n_A (int): Size of group A
###############
# Step 1:
# Create vector of zeroes of length "perms" to store
# permuted mean differnces
permuted_mean_differences<-rep(0,perms)
# Loop throught number of permutations
for (i in c(1:perms))
{
# Step 2:
# Randomly separate vector "values" into disjoint
# groups of size "nA" and "nB" respectively
temp<-sample(all_values)
group_A<-temp[1:n_A]
group_B<-temp[(n_A+1):length(temp)]
# Step 3:
# Compute the sample means for the two groups from
# step 2
mean_A<-mean(group_A,na.rm=T)
mean_B<-mean(group_B,na.rm=T)
# Step 4:
# Compute the difference in sample means, store the
# value in the vector from step 1
permuted_mean_differences[i]<-mean_A-mean_B
}
# Step 5:
# Return the permuted mean differences vector
return(permuted_mean_differences)
}
perm_cor <- function(perms = 1000, x, y)
{
## Variables ##
# perms: The number of permutations
# x: Vector of Variable 1 - for computing correlation
# y: Vector of Variable 2 - for computing correlation
###############
# Step 1:
# Create vector of zeroes of length "perms" to store
# permuted mean differnces
correlations<-rep(0,perms)
# Loop throught number of permutations
for (i in c(1:perms))
{
# Step 2:
# Randomly mix up the values in the vector "y"
temp<-sample(y)
# Step 3:
# Compute the correlation between x and the randomly mixed
# up y-vector. Store this value in the vector from step 1.
correlations[i]<-cor(x,temp,use="pairwise.complete.obs")
}
# Step 4:
# Return new updated vector, created in step 1
return(correlations)
}
co2_data<-co2_data%>%mutate(year=as.double(year))
co2_data
models <- co2_data %>%
split(.$country) %>%
map(~lm(co2_emissions_tonnes_per_person ~ year, data = .))
#models
correlation_coefficient<-models %>%
map(summary) %>%
map_dbl(~.$r.squared)
continents<-co2_data%>%select(country,continent)
df<-tibble("country"=names(correlation_coefficient),"cor"=correlation_coefficient)
df<-left_join(df,continents,by="country")
europe_correlations<-df%>%filter(continent=="europe")
americas_correlations<-df%>%filter(continent=="americas")
actual_mean_difference<-mean(americas_correlations$cor,na.rm=T)-mean(europe_correlations$cor,na.rm=T)
AE_correlations<-df%>%filter(continent=="americas"|continent=="europe")
permuted_means<-tibble("correlation"=perm_mean(perms=1000,all_values = AE_correlations$cor, n_A = nrow(americas_correlations)))
ggplot(permuted_means,aes(correlation,fill=(correlation<quantile(correlation,probs = c(.025),na.rm=T)[[1]]|correlation>quantile(correlation,probs = c(.975),na.rm=T)[[1]])))+
geom_histogram(binwidth = .003)+
geom_vline(xintercept=actual_mean_difference,color="red")+
labs(fill="Tails")
per<-nrow(filter(permuted_means,correlation<actual_mean_difference))/nrow(permuted_means)
percentile<-tibble("Mean Difference"=actual_mean_difference,"Percentile"=per)
percentile
#The code below takes the co2 data and maps the mean median and sd functions to all the numeric columns in the co2 data set, it was used to explore the characteristics of each of the columns before further examination
#using a permutation test
summary_mean<-co2_data%>%select(co2_emissions_tonnes_per_person:forest_coverage_percent)%>%map(mean,na.rm=T)
summary_mean<-as_tibble(summary_mean)%>%mutate(statistic="mean")
summary_median<-co2_data%>%select(co2_emissions_tonnes_per_person:forest_coverage_percent)%>%map(median,na.rm=T)
summary_median<-as_tibble(summary_median)%>%mutate(statistic="median")
summary_sd<-co2_data%>%select(co2_emissions_tonnes_per_person:forest_coverage_percent)%>%map(sd,na.rm=T)
summary_sd<-as_tibble(summary_sd)%>%mutate(statistic="sd")
summar<-reduce(list(summary_mean,summary_median,summary_sd),full_join)
summar<-summar%>%select(statistic,co2_emissions_tonnes_per_person:forest_coverage_percent)
summar
actual_correlation<-cor(co2_data$forest_coverage_percent,co2_data$co2_intensity_of_economic_output_kg_co2_per_2011_ppp_of_gdp, use="pairwise.complete.obs")
correlations_generated<-tibble(correlation=perm_cor(perms=1000,co2_data$forest_coverage_percent,co2_data$co2_intensity_of_economic_output_kg_co2_per_2011_ppp_of_gdp))
ggplot(data=correlations_generated,aes(correlation,fill=(correlation<quantile(correlation,probs = c(.025),na.rm=T)[[1]]|correlation>quantile(correlation,probs = c(.975),na.rm=T)[[1]])))+
geom_histogram()+
geom_vline(xintercept = actual_correlation,color="red")+
labs(title="Correlation Permutation Test Between CO2 Economic Intensity and Forest Cover",fill="Tails")
percentile<-nrow(filter(correlations_generated,correlation<actual_correlation))/nrow(correlations_generated)
correlation_summary<-tibble("Correlation"=c(actual_correlation),"Percentile"=c(percentile))
correlation_summary
